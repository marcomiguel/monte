server {
  listen                8080;
  server_name		dev.rpp.pe;
  root  /usr/share/nginx/dev.2.rpp.pe/public;
  index index.php index.html index.htm;

   access_log           /var/log/nginx/dev.rpp.pe-access.log;
   error_log            /var/log/nginx/dev.rpp.pe-error.log error;
 
  large_client_header_buffers 4 16k; 
 
  location / {

        if (-f $request_filename) {
            break;
        }

        if (!-e $request_filename) {
            rewrite ^(.+)$ /index.php?_url=$1 last;
            break;
        }
  }


  add_header 'Access-Control-Allow-Headers' 'Content-Type,Accept';
  add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
  add_header 'Access-Control-Allow-Origin' '*';


  location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
       fastcgi_pass 127.0.0.1:9000;
#        fastcgi_pass unix:/ops/remi/php56/root/var/run/php5-fpm-rpp.sock;
        fastcgi_index index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include fastcgi_params;
  }


  rewrite ^/([_a-zA-Z0-9-\-]+)-tema_([0-9]+)\.html http://$server_name/tema-$1 permanent;

  rewrite ^/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]-([_a-zA-Z0-9-\-]+)-noticia_([0-9]+)\.html http://$server_name/nota/permalink/$2 permanent;
  rewrite ^/([_a-zA-Z0-9-\-]+)-noticia_([0-9]+)\.html http://$server_name/nota/permalink/$2 permanent;
  rewrite ^/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]-([_a-zA-Z0-9-\‚Äê]+)-foto_([0-9]+)_([0-9]+)\.html http://$server_name/nota/permalink/$2 permanent;

###inicio redirecciones 404 fix
rewrite ^/archivo-audios.html http://$server_name/archivo permanent;
rewrite ^/archivo.html http://$server_name/archivo permanent;
rewrite ^/entretenimiento-famosos-seccion_673.html http://$server_name/famosos permanent;
rewrite ^/entretenimiento-cultura-seccion_678.html http://$server_name/cultura permanent;
rewrite ^/actualidad-seccion_593.html http://$server_name/mundo/actualidad permanent;
rewrite ^/entretenimiento-gastronomia-seccion_683.html http://$server_name/gastronomia permanent;
rewrite ^/actualidad-nacional-seccion_666.html http://$server_name/peru permanent;
rewrite ^/entretenimiento-cine-seccion_674.html http://$server_name/cine permanent;
rewrite ^/actualidad-insolito-seccion_860.html http://$server_name/virales/mas-virales permanent;
rewrite ^/movil-aplicaciones-seccion_197.html http://$server_name/tecnologia/mas-tecnologia permanent;
rewrite ^/lima-seccion_775.html http://$server_name/lima permanent;
rewrite ^/actualidad-salud-actualidad-salud-seccion_670.html http://$server_name/vida-y-estilo/salud permanent;
rewrite ^/entretenimiento-entretenimiento-seccion_595.html http://$server_name/entretenimiento permanent;
rewrite ^/espectaculos-entretenimiento-seccion_595.html http://$server_name/famosos permanent;
rewrite ^/rpp/vida-y-estilo/salud http://$server_name/vida-y-estilo/salud permanent;
rewrite ^/entretenimiento/2015-01-27-miss-universo-cibernautas-se-burlan-de-jimena-espinosa-foto_763694_1.html http://$server_name/lima/actualidad/miss-universo-cibernautas-se-burlan-de-jimena-espinosa-noticia-763694 permanent;
rewrite ^/tmp/miss-honduras-asesinada-noticia_743342.html http://$server_name/lima/actualidad/hallan-asesinadas-a-miss-honduras-mundo-2014-y-a-su-hermana-noticia-743342 permanent;
rewrite ^/actualidad/2014-08-20-pueblos-awajun-y-wampis-presentan-accion-contra-mem-y-perupetro-noticia_718215.html http://$server_name/economia/economia/pueblos-awajun-y-wampis-presentan-accion-contra-mem-y-perupetro-noticia-718215 permanent;
rewrite ^/especiales/fenomeno-el-nino-tema_693360.html http://$server_name/tema-fenomeno-el-nino permanent;

rewrite ^/([_a-zA-Z0-9-\-]+)-rss_([0-9]+)\.xml http://$server_name/feed/$1 permanent;

rewrite ^/programas-([_a-zA-Z0-9-\-]+)-seccion_([0-9]+)\.html http://$server_name/tema-$1 permanent;
rewrite ^/campanias-([_a-zA-Z0-9-\-]+)-seccion_([0-9]+)\.html http://$server_name/tema-$1 permanent;
rewrite ^/nid=([0-9]+) http://$server_name/nota/permalink/$1 permanent;
rewrite ^/rpp/([_a-zA-Z\-]+)/([_a-zA-Z\-]+) http://$server_name/$1/$2 permanent;

rewrite ^//-noticia-([0-9]+) http://$server_name/nota/permalink/$1 permanent;
rewrite ^/-noticia-([0-9]+) http://$server_name/nota/permalink/$1 permanent;

rewrite ^/plugins/feedback.php /nota/fbplugin last;


#####fin redirecciones 404 fix

 
  #rewrite ^/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]-([_a-zA-Z0-9-\-]+)-noticia_([0-9]+)\.html /nota/detalle/$2 last;
  #rewrite ^/([_a-zA-Z0-9-\-]+)-noticia_([0-9]+)\.html /nota/detalle/$2 last;


  rewrite ^/services/stream/jsonurls.php /stream/jsonurls last;
  rewrite ^/services/stream/urls.php /stream/urls last;
  rewrite ^/concursos.php /concurso last;

  rewrite ^/p/([0-9]+)/([0-9]+) /nota/permalink/$1/$2 last;

  rewrite ^/p/([0-9]+) /nota/permalink/$1 last;


  rewrite ^/([_a-zA-Z0-9-\-]+)_busqueda /tag/n/$1 last;

  rewrite ^/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9-\-]+)-noticia-([0-9]+)-full-screen/([0-9]+)  /nota/fullscreem/$4/$5 last;
  rewrite ^/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9-\-]+)-noticia-([0-9]+)-full-screen  /nota/fullscreem/$4 last;
  rewrite ^/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9-\-]+)-noticia-([0-9]+)/([0-9]+) /nota/detalle/$4/$5 last;
  rewrite ^/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9\-]+)/([_a-zA-Z0-9-\-]+)-noticia-([0-9]+) /nota/detalle/$4 last;



  rewrite ^/radioenvivo /envivo/radio last;
  rewrite ^/cabinaenvivo /envivo/cabina last;
  rewrite ^/embed/([_a-zA-Z\-]+) /envivo/embed/$1 last;
  rewrite ^/podcast/([_a-zA-Z0-9\-]+) /podcast/id/$1 last;


  rewrite ^/programacion/radio /envivo/programacionradio last;
  rewrite ^/programacion/tv /envivo/programacioncabina last;

rewrite ^/clima/([_a-zA-Z\-]+) /clima/portada/$1 last;
rewrite ^/clima /clima/portada last;


#rewrite para  categorias
rewrite ^/autores/([_a-zA-Z\-]+) /portada/seccion/autores/$1 last;
rewrite ^/blog/([_a-zA-Z\-]+) /blog/categoria/$1 last;
rewrite ^/politica/([_a-zA-Z\-]+) /portada/seccion/politica/$1 last;
rewrite ^/lima/([_a-zA-Z\-]+) /portada/seccion/lima/$1 last;
rewrite ^/mundo/([_a-zA-Z\-]+) /portada/seccion/mundo/$1 last;
rewrite ^/vida-y-estilo/([_a-zA-Z\-]+) /portada/seccion/vida-y-estilo/$1 last;
rewrite ^/viajes/([_a-zA-Z\-]+) /portada/seccion/viajes/$1 last;
rewrite ^/gastronomia/([_a-zA-Z\-]+) /portada/seccion/gastronomia/$1 last;
rewrite ^/mascotas/([_a-zA-Z\-]+) /portada/seccion/mascotas/$1 last;
rewrite ^/tecnologia/([_a-zA-Z\-]+) /portada/seccion/tecnologia/$1 last;
rewrite ^/ciencia/([_a-zA-Z\-]+) /portada/seccion/ciencia/$1 last;
rewrite ^/virales/([_a-zA-Z\-]+) /portada/seccion/virales/$1 last;
rewrite ^/peru/([_a-zA-Z\-]+) /portada/seccion/peru/$1 last;
rewrite ^/economia/([_a-zA-Z\-]+) /portada/seccion/economia/$1 last;
rewrite ^/futbol/([_a-zA-Z\-]+) /portada/seccion/futbol/$1 last;
rewrite ^/voley/([_a-zA-Z\-]+) /portada/seccion/voley/$1 last;
rewrite ^/tenis/([_a-zA-Z\-]+) /portada/seccion/tenis/$1 last;
rewrite ^/automovilismo/([_a-zA-Z\-]+) /portada/seccion/automovilismo/$1 last;
rewrite ^/lucha/([_a-zA-Z\-]+) /portada/seccion/lucha/$1 last;
rewrite ^/multideportes/([_a-zA-Z\-]+) /portada/seccion/multideportes/$1 last;
rewrite ^/cultura/([_a-zA-Z\-]+) /portada/seccion/cultura/$1 last;
rewrite ^/tv/([_a-zA-Z\-]+) /portada/seccion/tv/$1 last;
rewrite ^/cine/([_a-zA-Z\-]+) /portada/seccion/cine/$1 last;
rewrite ^/musica/([_a-zA-Z\-]+) /portada/seccion/musica/$1 last;
rewrite ^/famosos/([_a-zA-Z\-]+) /portada/seccion/famosos/$1 last;
rewrite ^/horoscopo/([_a-zA-Z\-]+) /portada/seccion/horoscopo/$1 last;
rewrite ^/tecnologia/([_a-zA-Z\-]+) /portada/seccion/tecnologia/$1 last;
rewrite ^/vida-y-estilo/([_a-zA-Z\-]+) /portada/seccion/vida-y-estilo/$1 last;


#secciones fixed

rewrite ^/vida-y-estilo /portada/seccion/vida-y-estilo last;
rewrite ^/tecnologia /portada/seccion/tecnologia last;
  
 #rewrite para agrupadores

  rewrite ^/autores /portada/autores last;
  rewrite ^/actualidad /portada/seccion/actualidad last;
  rewrite ^/deportes /portada/seccion/deportes last;
  rewrite ^/entretenimiento /portada/seccion/entretenimiento last;
  rewrite ^/peru /portada/seccion/peru last;
  rewrite ^/mundo /portada/seccion/mundo last;
  rewrite ^/economia /portada/seccion/economia last;
  rewrite ^/vida /portada/seccion/vida last;
  rewrite ^/tecno /portada/seccion/tec last;
  rewrite ^/viral /portada/seccion/virales last;


 #rewrite para secciones 


 rewrite ^/politica /portada/seccion/politica last;
 rewrite ^/lima /portada/seccion/lima last;
 rewrite ^/mundo /portada/seccion/mundo last;
 rewrite ^/vida-y-estilo /portada/seccion/vida-y-estilo last;
 rewrite ^/viajes /portada/seccion/viajes last;
 rewrite ^/gastronomia /portada/seccion/gastronomia last;
 rewrite ^/mascotas /portada/seccion/mascotas last;
 rewrite ^/tecnologia /portada/seccion/tecnologia last;
 rewrite ^/ciencia /portada/seccion/ciencia last;
 rewrite ^/virales /portada/seccion/virales last;
 rewrite ^/peru /portada/seccion/peru last;
 rewrite ^/economia /portada/seccion/economia last;
 rewrite ^/futbol /portada/seccion/futbol last;
 rewrite ^/voley /portada/seccion/voley last;
 rewrite ^/tenis /portada/seccion/tenis last;
 rewrite ^/automovilismo /portada/seccion/automovilismo last;
 rewrite ^/lucha /portada/seccion/lucha last;
 rewrite ^/multideportes /portada/seccion/multideportes last;
 rewrite ^/cultura /portada/seccion/cultura last;
 rewrite ^/tv /portada/seccion/tv last;
 rewrite ^/cine /portada/seccion/cine last;
 rewrite ^/musica /portada/seccion/musica last;
 rewrite ^/famosos /portada/seccion/famosos last;
 rewrite ^/horoscopo /portada/seccion/horoscopo last;
 #rewrite ^/tecnologia /portada/seccion/tecnologia last;
 #rewrite ^/vida-y-estilo /portada/seccion/vida-y-estilo last;


  
  rewrite ^/elecciones-peru-2016/redes /votaperu/redes last;
  rewrite ^/elecciones-peru-2016/encuesta /votaperu/encuesta last;
  rewrite ^/elecciones-peru-2016/resultados-presidenciales /resultadoselectorales/presidenciales last;
  rewrite ^/elecciones-peru-2016/resultados-congreso /resultadoselectorales/congreso last;
  rewrite ^/elecciones-peru-2016/resultados-parlamento-andino /resultadoselectorales/parlamentoandino last;
  rewrite ^/elecciones-peru-2016/debate/resultados /debate/resultados last;
  rewrite ^/elecciones-peru-2016/([_a-zA-Z0-9-\-]+)\.html /elecciones-peru-2016/$1.html last;
  rewrite ^/elecciones-peru-2016/([_a-zA-Z0-9-\-]+)\.css /elecciones-peru-2016/$1.css last;
  rewrite ^/elecciones-peru-2016/([_a-zA-Z0-9-\-]+)\.js /elecciones-peru-2016/$1.js last;
  rewrite ^/elecciones-peru-2016/js/([_a-zA-Z0-9-\-]+)\.js /elecciones-peru-2016/js/$1.js last;
  rewrite ^/elecciones-peru-2016/([_a-zA-Z0-9-\-]+)\.([_a-zA-Z0-9-\-]+)\.js /elecciones-peru-2016/$1.$2.js last;
  rewrite ^/elecciones-peru-2016/css/([_a-zA-Z0-9-\-]+)\.css /elecciones-peru-2016/css/$1.css last;
  rewrite ^/elecciones-peru-2016/img/encuesta_interactivo.jpg /elecciones-peru-2016/infografia_evolucion_intencion_de_voto.html last;
  rewrite ^/elecciones-peru-2016/img/([_a-zA-Z0-9-\-]+)\.jpg /elecciones-peru-2016/img/$1.jpg last;
  rewrite ^/elecciones-peru-2016/img/([_a-zA-Z0-9-\-]+)\.png /elecciones-peru-2016/img/$1.png last;
  rewrite ^/elecciones-peru-2016/img/([_a-zA-Z0-9-\-]+)\.gif /elecciones-peru-2016/img/$1.gif last;
  rewrite ^/elecciones-peru-2016/fonts/([_a-zA-Z0-9-\-]+)\.eot /elecciones-peru-2016/fonts/$1.eot last;
  rewrite ^/elecciones-peru-2016/fonts/([_a-zA-Z0-9-\-]+)\.woff /elecciones-peru-2016/fonts/$1.woff last;
  rewrite ^/elecciones-peru-2016/fonts/([_a-zA-Z0-9-\-]+)\.woff2 /elecciones-peru-2016/fonts/$1.woff2 last;
  rewrite ^/elecciones-peru-2016/fonts/([_a-zA-Z0-9-\-]+)\.svg /elecciones-peru-2016/fonts/$1.svg last;
  rewrite ^/elecciones-peru-2016/fonts/([_a-zA-Z0-9-\-]+)\.ttf /elecciones-peru-2016/fonts/$1.ttf last;
  rewrite ^/elecciones-peru-2016 /tag/n/elecciones-peru-2016 last;
  rewrite ^/tema-elecciones-peru-2016 http://$server_name/elecciones-peru-2016 permanent;


  rewrite ^/tema-la-candelaria/redes /candelaria/redes last;

  rewrite ^/tema-([_a-zA-Z0-9\-]+) /tag/n/$1 last;
  rewrite ^/archivo-12h /archivo/ultimas/12 last;
  rewrite ^/archivo-24h /archivo/ultimas/24 last;
  rewrite ^/archivo-1w /archivo/ultimas/168 last;
  rewrite ^/archivo-1m /archivo/ultimas/672 last;  

 

  rewrite ^/archivo/([_a-zA-Z\-]+)/([1-9])([0-9])([0-9])([0-9])-([0-9])([0-9])-([0-9])([0-9])  /archivo/seccion/$1/$2$3$4$5-$6$7-$8$9 last;
  rewrite ^/archivo/([_a-zA-Z\-]+)  /archivo/seccion/$1 last;
  rewrite ^/archivo/([1-9])([0-9])([0-9])([0-9])-([0-9])([0-9])-([0-9])([0-9])  /archivo/general/$1$2$3$4-$5$6-$7$8 last;
  rewrite ^/archivo /archivo/general last;

  rewrite ^/sitemap/web/([_a-zA-Z\-]+) /sitemap/weblistado/$1 last;
  rewrite ^/sitemap/news/([_a-zA-Z\-]+) /sitemap/newslistado/$1 last;
  rewrite ^/sitemap/tema-([_a-zA-Z0-9\-]+) /sitemap/tema/$1 last;

  rewrite ^/sitemap/archivos/([_a-zA-Z\-]+)/([1-9])([0-9])([0-9])([0-9])/([0-9])([1-9])  /sitemap/mes/$1/$2$3$4$5/$6$7 last;
  rewrite ^/sitemap/archivos/([_a-zA-Z\-]+)/([1-9])([0-9])([0-9])([0-9])  /sitemap/anio/$1/$2$3$4$5 last;
  rewrite ^/sitemap/archivos/([_a-zA-Z\-]+) /sitemap/archivoslistado/$1 last;
  rewrite ^/sitemap/archivos /sitemap/archivos last;
  rewrite ^/feed/tema-([_a-zA-Z\-]+) /feed/tag/$1 last;
  rewrite ^/feed/([_a-zA-Z\-]+)/([_a-zA-Z\-]+) /feed/seccion/$1/$2 last;
  rewrite ^/feed/([_a-zA-Z\-]+) /feed/seccion/$1 last;
  rewrite ^/el-gran-resumen-de-la-hora /resumenhora last;
  
}
