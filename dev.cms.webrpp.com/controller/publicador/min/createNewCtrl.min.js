app.controller("createNewCtrl",["$scope","$rootScope","$http","$document","$location","$anchorScroll","$preload","$mdDialog","$mdToast","$timeout","$create","Slug","$msj","$sce","$scrollGo","$localStorage","$login","$logout","$routeParams","$cacheService","$route","$filter","$isExtension","$insertJavascript","$window","$loadimg","$popup",function($scope,$rootScope,$http,$document,$location,$anchorScroll,$preload,$mdDialog,$mdToast,$timeout,$create,Slug,$msj,$sce,$scrollGo,$localStorage,$login,$logout,$routeParams,$cacheService,$route,$filter,$isExtension,$insertJavascript,$window,$loadimg,$popup){function modalCategoryAddCtrl(scope,$mdDialog){var DATATRANSFER=ng.DATATRANSFERMODAL;scope.categoryInput=[],scope.categoryOutput=[];var mapDataCategory=function(DATATRANSFER){var arrInput=[],arrOutput=[],DATA=DATATRANSFER;angular.forEach(DATA,function(v,i){DATA[i].ticked?arrOutput.push(DATA[i]):arrInput.push(DATA[i])}),scope.categoryInput=angular.copy(arrInput),scope.categoryOutput=angular.copy(arrOutput)};scope.categoryInputModel=void 0,scope.categoryOutputModel=void 0,ng.DATARETURNMODAL?(scope.categoryInput=angular.copy(ng.DATARETURNMODAL.input),scope.categoryOutput=angular.copy(ng.DATARETURNMODAL.output),scope.categoryOutputModel=[angular.copy(ng.DATARETURNMODAL.modelSelect)]):mapDataCategory(DATATRANSFER),scope.addCategoryElection=function(categoryInputModel){var categoryInputModel=categoryInputModel;angular.forEach(categoryInputModel,function(v,i){var _index=scope.categoryInput.indexOf(categoryInputModel[i]);_index>=0&&(scope.categoryOutput.push(categoryInputModel[i]),categoryInputModel[i].ticked=!0,categoryInputModel[i].primary=!1,scope.categoryInput.splice(_index,1))}),scope.categoryInputModel=void 0;var existPrimary=!1;angular.forEach(scope.categoryOutput,function(v,i){scope.categoryOutput[i].primary===!0&&(existPrimary=!0)}),existPrimary||(scope.categoryOutput[0].primary=!0)},scope.removeCategoryElection=function(categoryOutputModel){var categoryOutputModel=categoryOutputModel;angular.forEach(categoryOutputModel,function(v,i){var _index=scope.categoryOutput.indexOf(categoryOutputModel[i]);_index>=0&&(scope.categoryInput.push(categoryOutputModel[i]),categoryOutputModel[i].ticked=!1,scope.categoryOutput.splice(_index,1),scope.categoryOutput.length>0&&(categoryOutputModel[i].primary===!0?scope.categoryOutput[0].primary=!0:scope.categoryOutput[i].primary=!1))}),scope.categoryOutputModel=void 0},scope.changeCategoryOutputModel=function(categoryOutputModel){var categoryOutputModel=categoryOutputModel;if(scope.categoryOutputModel.length>1)scope.categoryOutputModel=void 0;else{angular.forEach(scope.categoryOutput,function(v,i){scope.categoryOutput[i].primary=!1});var _index=scope.categoryOutput.indexOf(categoryOutputModel[0]);scope.categoryOutput[_index].primary=!0}},scope.cancel=function(){$mdDialog.cancel()},scope.answerCategoryAll=function(jsonData){var modelSelect=void 0;angular.forEach(scope.categoryOutput,function(v,i){scope.categoryOutput[i].primary===!0&&(modelSelect=scope.categoryOutput[i])}),ng.DATARETURNMODAL={input:scope.categoryInput,output:scope.categoryOutput,modelSelect:modelSelect},$mdDialog.hide()}}function addPreviewNews(scope,$mdDialog,$document,$sce,$preload,response){var response=response;scope.readyDataByPublih=ng.parentReadyDataByPublish,scope.modalIsPublish=ng.isPublish,scope.addClosePreviewNews=function(){$mdDialog.hide()},scope.publishInPreviewNews=function($event){var $event=$event;ng.clickPublish($event,"preview")},scope.ifrmAddHTML=$sce.trustAsHtml('<iframe src="'+response+'" frameborder="0" scrolling="auto" style="width:100%; height:500px" id="ifrm"></iframe>'),$timeout(function(){var ifrm=angular.element("#ifrm");ifrm.css("visibility","hidden"),$timeout(function(){ifrm.css("visibility","visible"),$preload.hide()},8*TIMERESULT)},0),scope.previewRWD="desktop",scope.changePreviewRWD=function($event){var scopeSelect=scope.previewRWD;ng.responsiveModal(scopeSelect)},scope.urlPreviewNewWindow=response}function modalThumbAddCtrl(scope,$mdDialog,$preload){scope.widthImage=CMSDATA.DIMENSION16x9.widthLarge,scope.heightImage=CMSDATA.DIMENSION16x9.heightLarge,scope.cancel=function(){$mdDialog.cancel()},scope.answerThumb=function(){var fncLoadEditImg=function(){var elm=angular.element('#imgUploadThumb [name="thumb_values"]'),jsonData=elm.data("json");$preload.show();var DATA=angular.fromJson(jsonData);$http.post(URL+URLLISTTHUMBS,DATA).success(function(data){var data=data;if(data.status){var response=data.response;$mdDialog.hide(response)}else $msj.show(CMSDATA.MSJ.MSJ33,"top right"),$preload.hide()}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ33,"top right"),$preload.hide()})},elm=angular.element('#imgUploadThumb [name="thumb_values"]'),jsonData=elm.data("json");if(jsonData)fncLoadEditImg();else{var btnDonePhoto=angular.element("#imgUploadThumb .tools .md-cms-green");1===btnDonePhoto.size()?(btnDonePhoto.click(),$preload.show(),$timeout(function(){fncLoadEditImg()},TIMEWAITBTNDONE)):$msj.show(CMSDATA.MSJ.MSJ36,"top right")}}}var ng=$scope,URL=CMSDATA.GLOBAL.URLBASE,URLSESSION=(CMSDATA.GLOBAL.URLVIEW,"session"),URLPREVIEW="noticias/vistaprevia",URLSAVE="noticias/guardar",URLPUBLISH="noticias/publicar",URLREVISIONS="noticias/revisiones/",URLLISTCATEGORY="categoria/index/",URLLISTCATEGORYMULTIPLE="categoria/noticia/",URLSEARCHITEMS="noticias/?suggest=",URLCLOSESESSION="session/logout",URLEDITNEWS="noticias/leer/",URLLISTAUTHOR="user",URLLISTSITE="sitio",URLLISTSITELIST="sitio/list",URLLISTTHUMBS="noticias/imagenportada/",URLOADIMG="noticias/cargarimagen",URLVALIDPUBLISH="noticias/validar",URLFUENTES="noticias/fuentes",URLDELETE="noticias/eliminar/",URLLISTEVENTS="eventos/seleccionar",URLOADIMGPHOTO="elementos/upload/photo",TIMERESULT=250,TIMEWAITBTNDONE=2e3;$insertJavascript.fb("2.5");var positionMSj=CMSDATA.POSITIONMSJ;ng.filterText="";var fechaDesdeGlobal=(new Date).adjustDate(-2190);ng.filterFrom=fechaDesdeGlobal,ng.filterTo=CMSDATA.FILTER.hasta,ng.disabledCloseSession=!1;var nghome=ng.$parent;nghome.preloader=!1,ng.user={pictureUrl:!1},ng.tinymceOptions=CMSDATA.CONFIGEDITOR,ng.widthMedia=CMSDATA.DIMENSION16x9.widthLarge,ng.heightMedia=CMSDATA.DIMENSION16x9.heightLarge,$preload.show(),$login.get(URL+URLSESSION).then(function(data){var data=data;data.status?($localStorage.login=data.response,ng.user.pictureUrl=""==data.response.foto?!1:data.response.foto+"?"+(new Date).getTime(),ng.initList(data),$preload.hide()):($msj.show(CMSDATA.MSJ.MSJ0,positionMSj),delete $localStorage.login,$preload.hide(),$location.path("/"))},function(msgError){$msj.show(CMSDATA.MSJ.MSJ0,positionMSj),delete $localStorage.login,$preload.hide(),$location.path("/")}),ng.closeSession=function(){$logout.get(URL+URLCLOSESESSION)},ng.filterSite=void 0,ng.filterSites=[],ng.sites=[],ng.loadSiteHeader=function(existSite,type,callback){var type=type;$cacheService.get(URL+("search"!=type?URLLISTSITE:URLLISTSITELIST)).then(function(data){var data=data;data.status?"search"===type?(ng.filterSites=data.response,ng.filterSites.unshift({nombre:"Grupo RPP",slug:"grupo-rpp"})):(ng.sites=data.response,ng.objSitio=existSite?existSite:ng.sites[0],callback()):$msj.show(CMSDATA.MSJ.MSJ17,positionMSj)},function(msgError){$msj.show(CMSDATA.MSJ.MSJ17,positionMSj)})},ng.loadSiteHeader(void 0,"search"),ng.objAuthor=void 0,ng.filterAuthor=void 0,ng.filterAuthors=[],ng.autores=[],ng.loadAuthorHeader=function(existAuthor,type){$http.get(URL+URLLISTAUTHOR).success(function(data){var data=data;data.status?"search"===type?(ng.filterAuthors=data.response,ng.filterAuthors.unshift({foto:"",nombre:"Todos",slug:""})):(ng.autores=data.response,existAuthor?ng.objAuthor=existAuthor:$timeout(function(){ng.objAuthor={nombre:$localStorage.login.name,slug:$localStorage.login.username,foto:$localStorage.login.avatar}},3e3)):$msj.show(CMSDATA.MSJ.MSJ16,positionMSj)}).error(function(msgError){$msj.show(CMSDATA.MSJ.MSJ16,positionMSj)})},ng.loadAuthorHeader(void 0,"search"),ng.blk1=angular.copy(CMSDATA.OBJNEW),ng.showEditAddBlock=!1,ng.idEdit="-1";var reviewAddBlocks=function(){if(ng.blockAdd.length<=0)ng.isMediaLoad=!0;else for(var i=0;i<ng.blockAdd.length;i++){var _t=ng.blockAdd[i].tipo;if("photo"===_t||"video"===_t||"audio"===_t||"youtube"===_t){var iAfter=i;if(iAfter>0){var _tAfter=ng.blockAdd[iAfter-1].tipo;("text"===_tAfter||"embed"===_tAfter)&&(ng.isMediaLoad=!0)}else ng.isMediaLoad=!1;break}ng.isMediaLoad=!0}};ng.mamDisabled=!1,ng.loadSetEvents=!1,ng.noSetEvents=!1;var loadEventsAjax=function(type){if("delete"===type)ng.mamDisabled=!1,ng.objDataFactory="";else{for(var __ind,isMaM=!1,i=0;i<ng.blockAdd.length;i++)if("mam"===ng.blockAdd[i].tipo){isMaM=!0,__ind=i,ng.mamDisabled=!0;break}isMaM&&("drag"===type?$timeout(function(){angular.element("#idIconMaM"+ng.blockAdd[__ind].mam.id).parent().addClass("activomam")},10):(ng.loadSetEvents=!0,ng.noSetEvents=!1,$http.get(URL+URLLISTEVENTS+"?nid="+ng.nid).success(function(data){var data=data;data.status&&(ng.blockAdd[__ind].mam.mamIncidents=data.response?data.response:[],ng.loadSetEvents=!1,ng.noSetEvents=ng.blockAdd[__ind].mam.mamIncidents.length<=0?!0:!1,"edit"===type&&$timeout(function(){var __elm=angular.element("#idIconMaM"+ng.blockAdd[__ind].mam.id);if(__elm.size()>0)__elm.parent().addClass("activomam");else{var _IndM=angular.copy(ng.blockAdd[__ind].mam);ng.blockAdd[__ind].mam.mamIncidents.unshift(_IndM),$timeout(function(){var __elm=angular.element("#idIconMaM"+ng.blockAdd[__ind].mam.id);__elm.parent().addClass("activomam"),ng.objDataFactory=ng.blockAdd[__ind].mam.datafactory},10)}},10))}).error(function(data){})))}};ng.clickEventMaM=function(evt,mam,index,colimIndex){var elm=angular.element(evt.target);elm.parent().find("li").removeClass("activomam"),elm.addClass("activomam"),ng.blockAdd[colimIndex].mam.datafactory=mam.datafactory?mam.datafactory:"",ng.blockAdd[colimIndex].mam.id=mam.id?mam.id:"",ng.blockAdd[colimIndex].mam.titulo=mam.titulo?mam.titulo:"",ng.blockAdd[colimIndex].mam.fechaInicio=mam.fechaInicio?mam.fechaInicio:"",ng.objDataFactory=mam.datafactory,evt.preventDefault()},ng.flags={addPhoto:!0,addVideo:!0,addAudio:!0,addYoutube:!0,categoryMultiple:!0,addText:!0,addCite:!0,addRelated:!0,addEmbed:!0,thumbs:!0};var switchFlags=function(boolean){ng.flags.addPhoto=boolean,ng.flags.addVideo=boolean,ng.flags.addAudio=boolean,ng.flags.addYoutube=boolean,ng.flags.categoryMultiple=boolean,ng.flags.addText=boolean,ng.flags.addCite=boolean,ng.flags.addRelated=boolean,ng.flags.addEmbed=boolean,ng.flags.thumbs=boolean};ng.initList=function(data){function modalOpenAddTextCtrl(scope,$mdDialog,$create,modal,$timeout){scope.tinymceOptions=CMSDATA.CONFIGEDITOR,scope.modalType=modal.type,modal.block.relacionado.alineacion=null===modal.block.relacionado.alineacion?"":modal.block.relacionado.alineacion,scope.texto_edit="edit"===modal.type?modal.block.texto:"",scope.copyLinkSitio=ng.objSitio,scope.closeOpenAddText=function(){$mdDialog.cancel()},scope.addOpenAddText=function(){ng.ADDTEXTTRANSFER={texto:scope.texto_edit,tipo:"text",index:modal.index,type:modal.type},$mdDialog.hide()}}function modalOpenAddCiteCtrl(scope,$mdDialog,$create,modal,$timeout){modal.block.cita.alineacion=null===modal.block.cita.alineacion?"":modal.block.cita.alineacion,modal.block.cita.titulo=null===modal.block.cita.titulo?"":modal.block.cita.titulo,modal.block.cita.desarrollo=null===modal.block.cita.desarrollo?"":modal.block.cita.desarrollo,scope.tinymceOptions=CMSDATA.CONFIGEDITOR,scope.modalType=modal.type,scope.cita={alineacion:0===modal.block.cita.alineacion.length?CMSDATA.OBJNEW.cita.alineacion:modal.block.cita.alineacion,titulo:modal.block.cita.titulo,desarrollo:modal.block.cita.desarrollo},scope.modalType=scope.cita.alineacion!=CMSDATA.OBJNEW.cita.alineacion||scope.cita.titulo.length>0||$filter("htmlToPlaintext")(scope.cita.desarrollo).length>0?"edit":"add",scope.closeOpenAddCite=function(){$mdDialog.cancel()},scope.addOpenAddCite=function(){ng.ADDCITETRANSFER={cita:{alineacion:scope.cita.alineacion,titulo:scope.cita.titulo,desarrollo:scope.cita.desarrollo,index:modal.index,type:modal.type}},$mdDialog.hide()},scope.removeOpenAddCite=function(){ng.ADDCITETRANSFER={cita:{alineacion:CMSDATA.OBJNEW.cita.alineacion,titulo:CMSDATA.OBJNEW.cita.titulo,desarrollo:CMSDATA.OBJNEW.cita.desarrollo,index:modal.index,type:modal.type}},$mdDialog.hide()}}function modalOpenAddRelatedCtrl(scope,$mdDialog,$create,modal,$timeout,$msj){modal.block.relacionado.alineacion=null===modal.block.relacionado.alineacion?"":modal.block.relacionado.alineacion,scope.searchRel=void 0,scope.readonlySearchCT=!1,scope.listArrSocialNoResultCT=!1,scope.searchLoadCT=!1,scope.listArrRelated=[],scope.listArrSocialCT=[];var resetRelated=function(){scope.listArrRelated=[],scope.readonlySearchCT=!1,scope.searchRel=void 0,scope.listArrSocialCT=[]};scope.keySearchRelated=function($event){13===$event.which&&scope.searchRelated()},scope.searchRelated=function(){var type="web";scope.listArrSocialCT=[],scope.readonlySearchCT=!0,scope.searchLoadCT=!0,$http.get(CMSDATA.URLSEARCHSOCIAL+"/"+scope.searchRel+"/"+type+"?sitio="+ng.objSitio).success(function(data){var data=data;if(null!=data)if(data.status){var response=data.response;scope.listArrSocialCT=response?response:[],scope.searchLoadCT=!1,scope.readonlySearchCT=!1,$msj.show(CMSDATA.MSJ.MSJ28,positionMSj),scope.listArrSocialNoResultCT=response.length<=0?!0:!1}else scope.readonlySearchCT=!1,scope.searchLoadCT=!1,scope.listArrSocialNoResultCT=!1,$msj.show(CMSDATA.MSJ.MSJ29,positionMSj);else scope.searchLoadCT=!1,scope.readonlySearchCT=!1,scope.listArrSocialNoResultCT=!1,$msj.show(CMSDATA.MSJ.MSJ29,positionMSj)}).error(function(data){scope.searchLoadCT=!1,scope.readonlySearchCT=!1,scope.listArrSocialNoResultCT=!1,$msj.show(CMSDATA.MSJ.MSJ29,positionMSj)})},scope.clickCheckCT=function(index,obj){var index=index,obj=obj;scope.listArrRelated.push(obj),scope.listArrSocialCT.splice(index,1)},scope.clickRemoveCT=function(index){var index=index;scope.listArrRelated.splice(index,1)},modal.block.relacionado.alineacion=0===modal.block.relacionado.alineacion.length?CMSDATA.OBJNEW.relacionado.alineacion:modal.block.relacionado.alineacion,modal.block.relacionado.items.length>0||modal.block.relacionado.alineacion!=CMSDATA.OBJNEW.relacionado.alineacion?(modal.type="edit",scope.modalType="edit"):(modal.type="add",scope.modalType="add"),"edit"===modal.type?(scope.relacionado={alineacion:modal.block.relacionado.alineacion,items:modal.block.relacionado.items},scope.listArrRelated=modal.block.relacionado.items):(scope.relacionado={alineacion:CMSDATA.OBJNEW.relacionado.alineacion,items:CMSDATA.OBJNEW.relacionado.items},scope.listArrRelated=[]),scope.closeOpenAddText=function(){$mdDialog.cancel()},scope.addOpenAddText=function(){ng.ADDRELATEDTRANSFER={relacionado:{alineacion:scope.relacionado.alineacion,items:scope.listArrRelated,index:modal.index,type:modal.type}},$mdDialog.hide()},scope.removeOpenAddRelated=function(){scope.relacionado.alineacion=CMSDATA.OBJNEW.relacionado.alineacion,scope.relacionado.items=CMSDATA.OBJNEW.relacionado.items,scope.listArrRelated=[],resetRelated(),scope.addOpenAddText(),$timeout(function(){$mdDialog.hide()},0)}}function modalOpenAddPhotoCtrl(scope,$mdDialog,$create,modal,$timeout){scope.modalType=modal.type;var wImage=CMSDATA.DIMENSION16x9.widthXLarge,hHeight=CMSDATA.DIMENSION16x9.heightXLarge,orientation=(Math.round(16*wImage/9),function(wImage,hHeight){var wImage=wImage,hHeight=hHeight;return wImage>hHeight?"horizontal":"vertical"}),resetOrientation=function(_orientacion){var _orientacion=_orientacion;"horizontal"===_orientacion?(scope.widthImage=wImage,scope.heightImage=hHeight):(scope.widthImage=hHeight,scope.heightImage=wImage)},resetImgUpload=function(wImage,hHeight){var wImage=wImage,hHeight=hHeight;resetOrientation(orientation(wImage,hHeight)),scope.image="",scope.reset=$create.guid()};if(scope.tagsOnAppendPhoto=function(chip){return{nombre:chip,slug:"SLUG"}},"edit"===modal.type){scope.credito=modal.block.credito,scope.foto=modal.block.foto,scope.foto.tags=modal.block.foto.tags?modal.block.foto.tags:CMSDATA.OBJNEW.foto.tags,scope.parrafo1=modal.block.subtitulo,scope.via=modal.block.via;var extension=modal.extension;"gif"===extension?(scope.showThumbData=!0,scope.isDeleteThumb=!0,scope.isLoadThumb=!1,scope.srcThumbData=modal.block.foto.url):$timeout(function(){angular.element('#add-photo-modal input[name="thumb_values_edit"]').data("json","-1");var dataB64=modal.block.foto.data.data;if(null!=dataB64&&0!=dataB64.length){var img=new Image;resetImgUpload(wImage,hHeight),img.onload=function(){var height=img.height,width=img.width,wImage=parseInt(width?width:1,10),hHeight=parseInt(height?height:0,10);resetOrientation(orientation(wImage,hHeight)),scope.image=modal.block.foto.url,scope.reset=$create.guid()},img.src=modal.block.foto.url}else resetImgUpload(wImage,hHeight)},250),scope.removeCaptureImage=function(){scope.srcThumbData="",scope.showThumbData=!1,scope.isDeleteThumb=!1,scope.isLoadThumb=!0;var _elm=angular.element("#loadThumbDataGif");_elm.val(""),_elm.off("change")},scope.uploadCaptureImage=function(){var elm=angular.element("#loadThumbDataGif");elm.click(),angular.element("#loadThumbDataGif").on("change",function(evt){var files=evt.currentTarget.files,formdata=new FormData;angular.forEach(files,function(v,i){formdata.append("file_"+i,files[i])});var DATA=formdata;$preload.show(),$http.post(CMSDATA.URLMULTIPLEPHOTOS,DATA,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data){var data=data;if(data.status){var foto=data.response[0]?data.response[0].foto:"",url=foto.url;scope.showThumbData=!0,scope.isDeleteThumb=!0,scope.isLoadThumb=!1,scope.srcThumbData=url,$preload.hide()}else $msj.show(CMSDATA.MSJ.MSJ39,positionMSj),$preload.hide()}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ39,positionMSj),$preload.hide()})})}}else"cropear"===modal.type?(resetImgUpload(wImage,hHeight),scope.foto=angular.copy(CMSDATA.OBJNEW.foto),scope.credito=CMSDATA.OBJNEW.credito,scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via,$preload.show(),$http.get(modal.block.foto.urlb64).success(function(data){resetImgUpload(wImage,hHeight),scope.image=data,$preload.hide()}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ39,positionMSj),$preload.hide()})):(resetImgUpload(wImage,hHeight),scope.credito=CMSDATA.OBJNEW.credito,scope.foto=angular.copy(CMSDATA.OBJNEW.foto),scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via);scope.closeOpenAddPhoto=function(){$mdDialog.cancel()},scope.addOpenAddPhoto=function(){if(scope.foto.alt.length>0&&scope.parrafo1.length>0)if("gif"===extension)scope.foto.url=scope.srcThumbData,ng.ADDPHOTOTRANSFER={credito:scope.credito,foto:{alt:scope.foto.alt,attr:{align:scope.foto.attr.align},data:{data:scope.foto.url,name:"",url:scope.foto.url},descripcion:scope.foto.descripcion,id:$create.guid(),tags:scope.foto.tags,url:scope.foto.url,hash:scope.foto.hash},subtitulo:scope.parrafo1,via:scope.via,tipo:"photo",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide();else{var btnDonePhoto=angular.element("#add-photo-modal .tools .md-cms-green"),fncLoadEditImg=function(){var elmThumbVal=angular.element('#add-photo-modal input[name="thumb_values_edit"]').data("json"),jsonData=elmThumbVal;if("-1"===jsonData||""===jsonData)ng.ADDPHOTOTRANSFER={credito:scope.credito,foto:{alt:scope.foto.alt,attr:{align:scope.foto.attr.align},data:{data:scope.foto.url,name:"",url:scope.foto.url},descripcion:scope.foto.descripcion,id:$create.guid(),tags:scope.foto.tags,url:scope.foto.url,hash:scope.foto.hash},subtitulo:scope.parrafo1,via:scope.via,tipo:"photo",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide();else{$preload.show();var DATA=jsonData?angular.fromJson(jsonData):null;$http.post(URL+URLOADIMG,DATA).success(function(data){var data=data;if(data.status){var response=data.response;ng.ADDPHOTOTRANSFER={credito:scope.credito,foto:{alt:scope.foto.alt,attr:{align:scope.foto.attr.align},data:{data:response.url,name:"",url:response.url},descripcion:scope.foto.descripcion,id:$create.guid(),tags:scope.foto.tags,url:response.url,hash:response.hash},subtitulo:scope.parrafo1,via:scope.via,tipo:"photo",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide(),$preload.hide()}else $msj.show(CMSDATA.MSJ.MSJ35,"top right"),$preload.hide()}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ35,"top right"),$preload.hide()})}};1===btnDonePhoto.size()?(btnDonePhoto.click(),$preload.show(),$timeout(function(){fncLoadEditImg()},TIMEWAITBTNDONE)):fncLoadEditImg()}else scope.foto.alt.length<=0&&scope.parrafo1.length>0?$msj.show(CMSDATA.MSJ.MSJ55,CMSDATA.POSITIONMSJ):scope.parrafo1.length<=0&&scope.foto.alt.length>0?$msj.show(CMSDATA.MSJ.MSJ73,CMSDATA.POSITIONMSJ):$msj.show(CMSDATA.MSJ.MSJ74,CMSDATA.POSITIONMSJ)}}function modalOpenAddVideoCtrl(scope,$preload,$msj,$create,modal,$timeout){scope.modalType=modal.type,scope.widthVideo=ng.widthMedia,scope.heightVideo=ng.heightMedia,scope.resetVideo=!1,scope.refreshVideo=!1,scope.video={descripcion:"",tags:[],url:"",url_cover:"",duracion:"",hash:""},scope.$on("objvideo",function(e,msg){scope.video.url=msg.url_video,scope.video.url_cover=msg.url_video_cover,scope.video.duracion=msg.duracion,scope.video.hash=msg.hash}),scope.tagsOnAppendVideo=function(chip){return{nombre:chip,slug:"SLUG"}},"edit"===modal.type?(scope.credito=modal.block.credito,scope.video=modal.block.video,scope.video.tags=modal.block.video.tags?modal.block.video.tags:CMSDATA.OBJNEW.video.tags,scope.parrafo1=modal.block.subtitulo,scope.via=modal.block.via,$timeout(function(){scope.refreshVideo={url:scope.video.url,url_cover:scope.video.url_cover,duracion:scope.video.duracion,hash:scope.video.hash}},250)):(scope.credito=CMSDATA.OBJNEW.credito,scope.video=angular.copy(CMSDATA.OBJNEW.video),scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via),scope.closeOpenAddVideo=function(){$mdDialog.cancel()},scope.addOpenAddVideo=function(){if(scope.video.descripcion.length>0&&scope.parrafo1.length>0){var fncLoadModalVideo=function(){ng.ADDVIDEOTRANSFER={credito:scope.credito,video:{descripcion:scope.video.descripcion,tags:scope.video.tags,url:scope.video.url,url_cover:scope.video.url_cover,duracion:scope.video.duracion,hash:scope.video.hash},subtitulo:scope.parrafo1,via:scope.via,tipo:"video",index:modal.index,type:modal.type,indexNew:modal.indexNew}};if(0!=scope.video.url.length&&0!=scope.video.url_cover.length)fncLoadModalVideo(),$mdDialog.hide();else{var checkImgCover=angular.element("#add-video-modal #output li"),btnDoneVideo=angular.element("#add-video-modal #videoOptions .video_done");!checkImgCover.is(":disabled")&&checkImgCover.is(":visible")?$timeout(function(){btnDoneVideo.triggerHandler("click"),scope.$on("objvideo",function(e,msg){$timeout(function(){angular.element("#add-video-modal #videoPlayer").get(0).addEventListener("loadeddata",function(){fncLoadModalVideo(),$mdDialog.hide()},!1)},250)})},0):$msj.show(CMSDATA.MSJ.MSJ37,CMSDATA.POSITIONMSJ)}}else scope.video.descripcion.length<=0&&scope.parrafo1.length>0?$msj.show(CMSDATA.MSJ.MSJ55,CMSDATA.POSITIONMSJ):scope.parrafo1.length<=0&&scope.video.descripcion.length>0?$msj.show(CMSDATA.MSJ.MSJ73,CMSDATA.POSITIONMSJ):$msj.show(CMSDATA.MSJ.MSJ74,CMSDATA.POSITIONMSJ)}}function modalOpenAddAudioCtrl(scope,$create,modal,$timeout){scope.modalType=modal.type,scope.$on("objimagen",function(e,msg){var msg=msg,elm=angular.element(".tagzoneaudio .opt-send");msg?elm.removeAttr("disabled"):elm.attr("disabled","disabled")}),scope.widthAudio=ng.widthMedia,scope.heightAudio=ng.heightMedia,scope.refreshAudio=!1,scope.audio={descripcion:"",tags:[],url:"",url_cover:"",duracion:"",hash:""},scope.$on("objaudio",function(e,msg){scope.audio.url=msg.url,scope.audio.url_cover=msg.url_cover,scope.audio.duracion=msg.duracion,scope.audio.hash=msg.hash}),scope.image="",scope.widthImage=scope.widthAudio,scope.heightImage=scope.heightAudio,scope.tagsOnAppendAudio=function(chip){return{nombre:chip,slug:"SLUG"}},"edit"===modal.type?(scope.credito=modal.block.credito,scope.audio=modal.block.audio,scope.audio.tags=modal.block.audio.tags?modal.block.audio.tags:CMSDATA.OBJNEW.audio.tags,scope.parrafo1=modal.block.subtitulo,scope.via=modal.block.via,$timeout(function(){var elm=angular.element(".tagzoneaudio .opt-send");elm.css("display","inline-block"),elm.removeAttr("disabled"),scope.refreshAudio={url:scope.audio.url,url_cover:scope.audio.url_cover,duracion:scope.audio.duracion,hash:scope.audio.hash},scope.image=scope.audio.url_cover,scope.reset=$create.guid()},250)):($timeout(function(){var elm=angular.element(".tagzoneaudio .opt-send");elm.css("display","none"),elm.attr("disabled","disabled")},250),scope.credito=CMSDATA.OBJNEW.credito,scope.audio=angular.copy(CMSDATA.OBJNEW.audio),scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via),scope.closeOpenAddAudio=function(){$mdDialog.cancel()},scope.addOpenAddAudio=function(){scope.audio.descripcion.length>0&&scope.parrafo1.length>0?(ng.ADDAUDIOTRANSFER={credito:scope.credito,audio:{descripcion:scope.audio.descripcion,tags:scope.audio.tags,url:scope.audio.url,url_cover:scope.audio.url_cover,duracion:scope.audio.duracion,hash:scope.audio.hash},subtitulo:scope.parrafo1,via:scope.via,tipo:"audio",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide()):scope.audio.descripcion.length<=0&&scope.parrafo1.length>0?$msj.show(CMSDATA.MSJ.MSJ55,CMSDATA.POSITIONMSJ):scope.parrafo1.length<=0&&scope.audio.descripcion.length>0?$msj.show(CMSDATA.MSJ.MSJ73,CMSDATA.POSITIONMSJ):$msj.show(CMSDATA.MSJ.MSJ74,CMSDATA.POSITIONMSJ)}}function modalOpenAddEmbedCtrl(scope,$create,modal,$timeout){scope.modalType=modal.type,scope.tagsOnAppendEmbed=function(chip){return{nombre:chip,slug:"SLUG"}},"edit"===modal.type?(scope.credito=modal.block.credito,scope.embed=modal.block.embed,scope.embed_data=modal.block.embed_data?modal.block.embed_data:CMSDATA.OBJNEW.embed_data,scope.parrafo1=modal.block.subtitulo,scope.via=modal.block.via):(scope.credito=CMSDATA.OBJNEW.credito,scope.embed=CMSDATA.OBJNEW.embed,scope.embed_data=angular.copy(CMSDATA.OBJNEW.embed_data),scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via),scope.closeOpenAddEmbed=function(){$mdDialog.cancel()},scope.addOpenAddEmbed=function(){scope.embed_data.descripcion.length>0&&scope.parrafo1.length>0?(ng.ADDEMBEDTRANSFER={credito:scope.credito,embed:scope.embed,embed_data:{descripcion:scope.embed_data.descripcion,tags:scope.embed_data.tags},subtitulo:scope.parrafo1,via:scope.via,tipo:"embed",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide()):scope.embed_data.descripcion.length<=0&&scope.parrafo1.length>0?$msj.show(CMSDATA.MSJ.MSJ55,CMSDATA.POSITIONMSJ):scope.parrafo1.length<=0&&scope.embed_data.descripcion.length>0?$msj.show(CMSDATA.MSJ.MSJ73,CMSDATA.POSITIONMSJ):$msj.show(CMSDATA.MSJ.MSJ74,CMSDATA.POSITIONMSJ)}}function modalOpenAddYoutubeCtrl(scope,$create,modal,$timeout){angular.element("#add-img--cover");ng.showThumbData=!1,ng.isDeleteThumb=!1,scope.uploadCaptureImage=function(){var elm=angular.element("#add-img--cover"),thumbData=elm.find(".loadThumbData");thumbData.click(),elm.find(".loadThumbData").on("change",function(evt){var file=evt.currentTarget.files[0],formdata=new FormData;formdata.append("file",file);var DATA=formdata;$preload.show(),$http.post(CMSDATA.URLMULTIPLEPHOTOS,DATA,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data){var data=data;if(data.status){var foto=data.response[0]?data.response[0].foto:"",url=foto.url;ng.showThumbData=!0,ng.isDeleteThumb=!0,ng.srcThumbData=url,$preload.hide()}else $msj.show(CMSDATA.MSJ.MSJ39,positionMSj),$preload.hide()}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ39,positionMSj),$preload.hide()})})},scope.removeCaptureImage=function(){scope.srcThumbData="",angular.element("#zone-img--youtube img").attr("src",""),scope.showThumbData=!1,ng.isDeleteThumb=!1},scope.modalType=modal.type;var youTubeGetParams=function(url){var ID="",_url=url.replace(/(>|<)/gi,"");url=_url.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),_timestamp=_url.split(/(t=|&start=|&amp;start=)/),_autoplay=_url.split(/(autoplay=|&autoplay=|&amp;autoplay=)/);var ID,TIMESTAMP,AUTOPLAY;return void 0!==url[2]?(ID=url[2].split(/[^0-9a-z_\-]/i),ID=ID[0]):ID=url,void 0!==_timestamp[2]?(TIMESTAMP=_timestamp[2].split(/[^0-9a-z_\-]/i),TIMESTAMP=TIMESTAMP[0]):TIMESTAMP="",void 0!==_autoplay[2]?(AUTOPLAY=_autoplay[2].split(/[^0-9a-z_\-]/i),AUTOPLAY=AUTOPLAY[0]):AUTOPLAY="",{ID:ID,TIMESTAMP:TIMESTAMP,AUTOPLAY:AUTOPLAY}};scope.pasteVideoYoutube=function(_model){var params=youTubeGetParams(scope.youtube.url);scope.youtube.autoplay="true"===params.AUTOPLAY||"1"===params.AUTOPLAY?!0:!1,scope.youtube.id=params.ID,scope.youtube.timestamp=params.TIMESTAMP},scope.changeTimeYoutube=function(_model){var params=youTubeGetParams(scope.youtube.url);scope.youtube.url=scope.youtube.url.replace("#t="+params.TIMESTAMP||"t="+params.TIMESTAMP,"#t="+scope.youtube.timestamp)},scope.tagsOnAppendYoutube=function(chip){return{nombre:chip,slug:"SLUG"}},"edit"===modal.type?(scope.credito=modal.block.credito,console.log(modal.block.youtube,"modal.block.youtube"),scope.youtube=angular.copy(modal.block.youtube),scope.youtube.url=modal.block.youtube.url?modal.block.youtube.url:"https://youtu.be/"+modal.block.youtube.id,scope.youtube.tags=modal.block.youtube.tags?modal.block.youtube.tags:CMSDATA.OBJNEW.youtube.tags,scope.srcThumbData=modal.block.youtube.hasOwnProperty("url_cover")?modal.block.youtube.url_cover:"",scope.parrafo1=modal.block.subtitulo,scope.via=modal.block.via,scope.srcThumbData.length>0?(ng.showThumbData=!0,ng.isDeleteThumb=!0):(ng.showThumbData=!1,ng.isDeleteThumb=!1)):(scope.credito="",scope.youtube=CMSDATA.OBJNEW.youtube,scope.youtube.url="",scope.srcThumbData="",scope.parrafo1=CMSDATA.OBJNEW.parrafo1,scope.via=CMSDATA.OBJNEW.via),scope.closeOpenAddYoutube=function(){$mdDialog.cancel()},scope.addOpenAddYoutube=function(){scope.youtube.descripcion&&scope.youtube.descripcion.length>0&&scope.parrafo1.length>0?scope.srcThumbData.length>0?(ng.ADDYOUTUBETRANSFER={credito:scope.credito,youtube:{autoplay:scope.youtube.autoplay,descripcion:scope.youtube.descripcion,id:scope.youtube.id,tags:scope.youtube.tags,timestamp:scope.youtube.timestamp,url:scope.youtube.url,url_cover:scope.srcThumbData},subtitulo:scope.parrafo1,via:scope.via,tipo:"youtube",index:modal.index,type:modal.type,indexNew:modal.indexNew},$mdDialog.hide()):$msj.show(CMSDATA.MSJ.MSJ40,positionMSj):scope.youtube.descripcion&&scope.youtube.descripcion.length<=0&&scope.parrafo1.length>0?$msj.show(CMSDATA.MSJ.MSJ55,CMSDATA.POSITIONMSJ):scope.parrafo1.length<=0&&scope.youtube.descripcion&&scope.youtube.descripcion.length>0?$msj.show(CMSDATA.MSJ.MSJ73,CMSDATA.POSITIONMSJ):$msj.show(CMSDATA.MSJ.MSJ74,CMSDATA.POSITIONMSJ)}}ng.filterState=void 0,ng.filterStates=$cacheService.getState(),ng.filterTypeContent=void 0,ng.filterTypeContents=$cacheService.getTypeContent(),ng.objF={filtroColeccion:""},ng.filterSection=void 0,ng.filterSections=[],ng.loadSectionHeader=function(sitio){var _sitio=sitio?sitio:"rpp";$cacheService.get(URL+URLLISTCATEGORY+_sitio+"?type=search_box").then(function(data){var data=data;data.status?ng.filterSections=data.response:$msj.show(CMSDATA.MSJ.MSJ13,positionMSj)},function(msgError){$msj.show(CMSDATA.MSJ.MSJ13,positionMSj)})},ng.loadSectionHeader(void 0),ng.changeLoadSectionHeader=function(){var _sitio=ng.filterSite?ng.filterSite.slug:void 0;ng.loadSectionHeader(_sitio)},ng.noEsUrl=!0,ng.cambioTipoPublicador=function($event){ng.noEsUrl="url"===ng.objTipo?!1:!0},ng.formOptionSearch=!1,ng.layerSearch=!1,$body=angular.element("body"),ng.custom=!0,ng.btnOpenFilter=function($event){var $frm=(angular.element($event.target),angular.element("#contentSearch"));ng.custom=ng.custom===!1?!0:!1,ng.custom?(ng.formOptionSearch=!1,$frm.removeClass("focus"),ng.layerSearch=!1):(ng.formOptionSearch=!0,
$frm.addClass("focus"),ng.layerSearch=!0)},ng.hideLayer=function($event){angular.element($event.target);ng.resetLayerSearch()},ng.searchFilterNews=function($event){ng.refresRootDataSearch(),ng.resetLayerSearch(),$rootScope.datasearchOutPage=$rootScope.datasearch,$location.path("/publicador"),$event.preventDefault()},ng.resetLayerSearch=function(){$frm=angular.element("#contentSearch"),ng.formOptionSearch=!1,$frm.removeClass("focus"),ng.layerSearch=!1,ng.custom=!0},ng.getItemsSearch=function($event,searchText){return $http.get(URL+URLSEARCHITEMS+searchText).then(function(response){return response.data.response})},$timeout(function(){var $elemIptSearch=angular.element('.filterText input[type="search"]');$elemIptSearch.unbind("keyup").bind("keyup",function(e){13===e.which?ng.$apply(function(){ng.refresRootDataSearch(),$rootScope.datasearchOutPage=$rootScope.datasearch,$location.path("/publicador"),e.stopPropagation(),e.preventDefault()}):(e.stopPropagation(),e.preventDefault())})},TIMERESULT+TIMERESULT/4),ng.refresRootDataSearch=function(){var texto=ng.filterText?ng.filterText:"",sitio=ng.filterSite?ng.filterSite:"",categoria=ng.filterSection?ng.filterSection:"",tipo=ng.filterTypeContent?ng.filterTypeContent:"",desde=ng.filterFrom?ng.filterFrom:fechaDesdeGlobal,hasta=ng.filterTo?ng.filterTo:"",estado=ng.filterState?ng.filterState:"",autor=ng.filterAuthor?ng.filterAuthor:"";$rootScope.datasearch={texto:texto,sitio:sitio,categoria:categoria,tipo:tipo,desde:desde,hasta:hasta,estado:estado,autor:autor},ng.resetLayerSearch()},ng.search=function($event){var $event=$event;13===$event.which&&(ng.refresRootDataSearch(),$event.preventDefault())},ng.trustResource=function(resourceUrl){return $sce.trustAsResourceUrl(resourceUrl)},ng.isMediaLoad=!0,reviewAddBlocks(),ng.addMedia=function(index,obj,indexNew){var obj=obj,index=index,indexNew=indexNew,addImgMini=function(obj){switch(obj.tipo){case"photo":var imgData=obj.foto;ng.addNewPhotoThumb(imgData,!0);break;case"youtube":var imgData=angular.copy(obj.youtube);imgData.url=imgData.url_cover,ng.addNewPhotoThumb(imgData,!0);break;case"video":var imgData=CMSDATA.OBJNEW.foto;imgData.url=obj.video.url_cover,imgData.url.length>0&&ng.addNewPhotoThumb(imgData,!0);break;case"audio":var imgData=angular.copy(obj.audio);imgData.url=imgData.url_cover,ng.addNewPhotoThumb(imgData,!0);break;case"embed":var __isEmbed=obj.embed;__isEmbed&&(__isEmbed.indexOf("fb-root")?"undefined"!=typeof FB&&$timeout(function(){FB.XFBML.parse(document.getElementById("block-ui-add"))},0):__isEmbed.indexOf("twitter")&&"undefined"!=typeof twttr&&twttr.widgets.load())}reviewAddBlocks()};if(angular.isNumber(indexNew)){var $index=0>indexNew?0:void 0;ng.blockAdd.splice($index,0,obj),addImgMini(obj)}else ng.blockAdd.splice(index,0,obj),addImgMini(obj)},ng.deleteBlock=function($event,$index,block){var $index=$index,confirmDelete=$mdDialog.confirm({title:"Confirmación",content:"¿Está seguro que desea eliminar?",ok:"Aceptar",cancel:"Cancelar"});$mdDialog.show(confirmDelete).then(function(){ng.closeDeleteBlock($index),reviewAddBlocks(),loadEventsAjax("delete")})["finally"](function(){confirmDelete=void 0})},ng.closeDeleteBlock=function($index){var index=$index;ng.blockAdd.splice(index,1),reviewAddBlocks(),$mdDialog.cancel()},ng.showOpenTextNew={},ng.clickAddText=function($event,$index){var $index=$index;angular.isNumber($index)?ng.showOpenTextNew[$index]=ng.showOpenTextNew[$index]?!1:!0:ng.showOpenText=ng.showOpenText?!1:!0},ng.ADDTEXTTRANSFER=void 0,ng.textoNew={},ng.flags.addText=!1,ng.openAddText=function($event,type,$index,block,$indexNew){switchFlags(!0);var type=type,index=$index,block=block,$indexNew=$indexNew;if("add"===type){if(angular.isNumber($indexNew)){var objTextAdd=angular.copy(CMSDATA.OBJNEW);objTextAdd.texto=ng.textoNew[$indexNew],objTextAdd.tipo="text";var index=$indexNew+1;ng.addMedia(index,objTextAdd),ng.textoNew[$indexNew]="",ng.showOpenTextNew[$indexNew]=!1}else{var objTextAdd=angular.copy(CMSDATA.OBJNEW);objTextAdd.texto=ng.texto,objTextAdd.tipo="text";var index=ng.blockAdd.length;ng.addMedia(index,objTextAdd),ng.texto=""}switchFlags(!1)}else $mdDialog.show({targetEvent:$event,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddtext.html",controller:modalOpenAddTextCtrl,locals:{modal:{type:type,index:index,block:block}}}).then(function(){ng.ADDTEXTTRANSFER&&(ng.blockAdd[ng.ADDTEXTTRANSFER.index].texto=ng.ADDTEXTTRANSFER.texto),switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDCITETRANSFER=void 0,ng.flags.addCite=!1,ng.openAddCite=function($event,type,$index,block){switchFlags(!0);var type=type,index=$index,block=block;$mdDialog.show({targetEvent:$event,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddcite.html",controller:modalOpenAddCiteCtrl,locals:{modal:{type:type,index:index,block:block}}}).then(function(){if(ng.ADDCITETRANSFER){var objCiteAdd=angular.copy(CMSDATA.OBJNEW.cita);objCiteAdd.alineacion=ng.ADDCITETRANSFER.cita.alineacion,objCiteAdd.titulo=ng.ADDCITETRANSFER.cita.titulo,objCiteAdd.desarrollo=ng.ADDCITETRANSFER.cita.desarrollo,ng.blockAdd[ng.ADDCITETRANSFER.cita.index].cita=angular.copy(objCiteAdd)}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDRELATEDTRANSFER=void 0,ng.flags.addRelated=!1,ng.openAddRelated=function($event,type,$index,block){switchFlags(!0);var type=type,index=$index,block=block;$mdDialog.show({targetEvent:$event,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddrelated.html",controller:modalOpenAddRelatedCtrl,locals:{modal:{type:type,index:index,block:block}}}).then(function(){if(ng.ADDRELATEDTRANSFER){var objRelatedAdd=angular.copy(CMSDATA.OBJNEW.relacionado);objRelatedAdd.alineacion=ng.ADDRELATEDTRANSFER.relacionado.alineacion,objRelatedAdd.items=ng.ADDRELATEDTRANSFER.relacionado.items,ng.blockAdd[ng.ADDRELATEDTRANSFER.relacionado.index].relacionado=angular.copy(objRelatedAdd)}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.dClickFalse=function($event){return!1},ng.ADDPHOTOTRANSFER=void 0,ng.flags.addPhoto=!1,ng.openAddPhoto=function($event,type,$index,block,$indexNew){switchFlags(!0);var type=type,index=$index,block=block,$indexNew=$indexNew,extension=$isExtension.get(block.hasOwnProperty("foto")?block.foto.url:void 0);$mdDialog.show({targetEvent:$event,templateUrl:"cropear"!=type?"gif"===extension?CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddphotogif.html":CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddphoto.html":CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddphotoarchive.html",controller:modalOpenAddPhotoCtrl,locals:{modal:{type:type,index:index,block:block,extension:extension,indexNew:$indexNew}}}).then(function(){if(ng.ADDPHOTOTRANSFER){var objPhotoAdd=angular.copy(CMSDATA.OBJNEW);if(objPhotoAdd.credito=ng.ADDPHOTOTRANSFER.credito,objPhotoAdd.subtitulo=ng.ADDPHOTOTRANSFER.subtitulo,objPhotoAdd.via=ng.ADDPHOTOTRANSFER.via,objPhotoAdd.tipo=ng.ADDPHOTOTRANSFER.tipo,objPhotoAdd.foto=angular.copy(ng.ADDPHOTOTRANSFER.foto),"add"===ng.ADDPHOTOTRANSFER.type||"cropear"===ng.ADDPHOTOTRANSFER.type){var index=ng.blockAdd.length;ng.addMedia(index,objPhotoAdd,ng.ADDPHOTOTRANSFER.indexNew)}else ng.blockAdd[ng.ADDPHOTOTRANSFER.index]=angular.copy(objPhotoAdd)}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDVIDEOTRANSFER=void 0,ng.flags.addVideo=!1,ng.openAddVideo=function($event,type,$index,block,$indexNew){switchFlags(!0),$mdDialog.cancel();var type=type,index=$index,block=block,$indexNew=$indexNew;$mdDialog.show({targetEvent:$event,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddvideo.html",controller:modalOpenAddVideoCtrl,locals:{modal:{type:type,index:index,block:block,indexNew:$indexNew}}}).then(function(){if(ng.ADDVIDEOTRANSFER){var objVideoAdd=angular.copy(CMSDATA.OBJNEW);if(objVideoAdd.credito=ng.ADDVIDEOTRANSFER.credito,objVideoAdd.subtitulo=ng.ADDVIDEOTRANSFER.subtitulo,objVideoAdd.via=ng.ADDVIDEOTRANSFER.via,objVideoAdd.tipo=ng.ADDVIDEOTRANSFER.tipo,objVideoAdd.video=angular.copy(ng.ADDVIDEOTRANSFER.video),"add"===ng.ADDVIDEOTRANSFER.type){var index=ng.blockAdd.length;ng.addMedia(index,objVideoAdd,ng.ADDVIDEOTRANSFER.indexNew)}else{var ind=ng.ADDVIDEOTRANSFER.index;ng.blockAdd[ind]=angular.copy(objVideoAdd)}}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDAUDIOTRANSFER=void 0,ng.flags.addAudio=!1,ng.openAddAudio=function($event,type,$index,block,$indexNew){switchFlags(!0),$mdDialog.cancel();var type=type,index=$index,block=block,$indexNew=$indexNew;$mdDialog.show({targetEvent:$event,scope:$scope,preserveScope:!0,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddaudio.html",controller:modalOpenAddAudioCtrl,locals:{modal:{type:type,index:index,block:block,indexNew:$indexNew}}}).then(function(){if(ng.ADDAUDIOTRANSFER){var objAudioAdd=angular.copy(CMSDATA.OBJNEW);if(objAudioAdd.credito=ng.ADDAUDIOTRANSFER.credito,objAudioAdd.subtitulo=ng.ADDAUDIOTRANSFER.subtitulo,objAudioAdd.via=ng.ADDAUDIOTRANSFER.via,objAudioAdd.tipo=ng.ADDAUDIOTRANSFER.tipo,objAudioAdd.audio=angular.copy(ng.ADDAUDIOTRANSFER.audio),"add"===ng.ADDAUDIOTRANSFER.type){var index=ng.blockAdd.length;ng.addMedia(index,objAudioAdd,ng.ADDAUDIOTRANSFER.indexNew)}else{var ind=ng.ADDAUDIOTRANSFER.index;ng.blockAdd[ind]=angular.copy(objAudioAdd)}}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDEMBEDTRANSFER=void 0,ng.flags.addEmbed=!1,ng.openAddEmbed=function($event,type,$index,block,$indexNew){switchFlags(!0);var type=type,index=$index,block=block,$indexNew=$indexNew;$mdDialog.show({targetEvent:$event,scope:$scope,preserveScope:!0,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddembed.html",controller:modalOpenAddEmbedCtrl,locals:{modal:{type:type,index:index,block:block,indexNew:$indexNew}}}).then(function(){if(ng.ADDEMBEDTRANSFER){var objEmbedAdd=angular.copy(CMSDATA.OBJNEW);if(objEmbedAdd.credito=ng.ADDEMBEDTRANSFER.credito,objEmbedAdd.subtitulo=ng.ADDEMBEDTRANSFER.subtitulo,objEmbedAdd.via=ng.ADDEMBEDTRANSFER.via,objEmbedAdd.tipo=ng.ADDEMBEDTRANSFER.tipo,objEmbedAdd.embed=ng.ADDEMBEDTRANSFER.embed,objEmbedAdd.embed_data=angular.copy(ng.ADDEMBEDTRANSFER.embed_data),"add"===ng.ADDEMBEDTRANSFER.type){var index=ng.blockAdd.length;ng.addMedia(index,objEmbedAdd,ng.ADDEMBEDTRANSFER.indexNew)}else{var ind=ng.ADDEMBEDTRANSFER.index;ng.blockAdd[ind]=angular.copy(objEmbedAdd)}}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.ADDYOUTUBETRANSFER=null,ng.flags.addYoutube=!1,ng.openAddYoutube=function($event,type,$index,block,$indexNew){switchFlags(!0),$mdDialog.cancel();var type=type,index=$index,block=block,$event=$event,$indexNew=$indexNew;$mdDialog.show({targetEvent:$event,scope:$scope,preserveScope:!0,bindToController:!0,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/openaddyoutube.html",controller:modalOpenAddYoutubeCtrl,locals:{modal:{type:type,index:index,block:block,indexNew:$indexNew}}}).then(function(){if(ng.ADDYOUTUBETRANSFER){var ngTransfer=angular.copy(ng.ADDYOUTUBETRANSFER),objYoutubeAdd=angular.copy(CMSDATA.OBJNEW);if(objYoutubeAdd.credito=ngTransfer.credito,objYoutubeAdd.subtitulo=ngTransfer.subtitulo,objYoutubeAdd.via=ngTransfer.via,objYoutubeAdd.tipo=ngTransfer.tipo,objYoutubeAdd.youtube=angular.copy(ngTransfer.youtube),"add"===ngTransfer.type){var obj=angular.copy(ngTransfer),index=ng.blockAdd.length;ng.addMedia(index,obj,ng.ADDYOUTUBETRANSFER.indexNew)}else{var ind=ngTransfer.index;ng.blockAdd[ind]=angular.copy(objYoutubeAdd)}}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.openAddMaM=function($event,type,$index,block,$indexNew){var type=type,index=$index,$indexNew=$indexNew,objMaMAdd=CMSDATA.OBJNEW;if(objMaMAdd.tipo="mam",objMaMAdd.mam.mamIncidents=[],"add"===type){var index=ng.blockAdd.length;ng.addMedia(index,objMaMAdd,$indexNew),loadEventsAjax("add")}};var elmFile=angular.element("#inputFileTrigger"),elmFileGif=angular.element("#inputFileTriggerGif");elmFile.val("").removeAttr("data-index").removeAttr("data-typephoto"),elmFileGif.val("").removeAttr("data-index").removeAttr("data-typephoto"),ng.openAddPhotoGallery=function($event,type,typephoto,$indexNew){var elmFile=angular.element("#inputFileTrigger"),elmFileGif=angular.element("#inputFileTriggerGif");elmFile.val("").removeAttr("data-index").removeAttr("data-typephoto"),elmFileGif.val("").removeAttr("data-index").removeAttr("data-typephoto");var typephoto=typephoto,$indexNew=$indexNew;elmFile.attr({"data-index":$indexNew,"data-typephoto":typephoto}),elmFileGif.attr({"data-index":$indexNew,"data-typephoto":typephoto}),elmFile.val(""),elmFileGif.val(""),"gif"===typephoto?elmFileGif.click():elmFile.click()};var loadPhoto=function(files,typeIndex){var files=files,typeIndex={typephoto:typeIndex.typephoto,indexNew:typeIndex.indexNew},formdata=new FormData;angular.forEach(files,function(v,i){formdata.append("file_"+i,files[i])});var DATA=formdata;$preload.show(),$http.post(CMSDATA.URLMULTIPLEPHOTOS,DATA,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data){var data=data;if(data.status){var response=data.response?data.response:[],index=ng.blockAdd.length,count=0;angular.forEach(response,function(v,i){var obj=v,_ind=index+count;ng.addMedia(_ind,obj,typeIndex.indexNew),count++}),$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ24,positionMSj)}else $preload.hide(),$msj.show(CMSDATA.MSJ.MSJ23,positionMSj)}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ23,positionMSj)})};elmFile.bind("change",function(){ng.$apply(function(){var files=elmFile[0].files;loadPhoto(files,{typephoto:"",indexNew:angular.element("#inputFileTrigger").data("index")})})}),elmFileGif.bind("change",function(){ng.$apply(function(){var files=elmFileGif[0].files;loadPhoto(files,{typephoto:"gif",indexNew:angular.element("#inputFileTriggerGif").data("index")})})}),ng.triggerModule=function($event,module){var mod=module;switch(mod){case"gallery":ng.$broadcast("triggerGallery",!0);break;case"covers":}};var fileClone=CMSDATA.OBJNEW;ng.fileClone=fileClone,$rootScope.$on("draggable:start",function(evt,obj){var obj=obj,hideClone=function(){ng.fileClone=fileClone,angular.element("#zone-clone").hide()},data=obj.data;if(data&&data.hasOwnProperty("drag"))switch(data.tipo){case"archive":ng.fileClone=data;break;case"photo":ng.fileClone=data;break;case"youtube":ng.fileClone=data;break;case"embed":ng.fileClone=data;break;case"text":ng.fileClone=data;break;default:hideClone()}else hideClone()}),$rootScope.$on("draggable:end",function(event,obj){ng.fileClone=fileClone,angular.element("#zone-clone").show()}),ng.openCreateNew=function($event,$type,nid){var _nid=nid,_type=$type;$preload.show(),_nid||($preload.hide(),$rootScope.objInitNews={response:void 0,type:_type},$location.path("/publicador/noticia"))};var dateRSA=new Date;ng.dateTimeRS={date:dateRSA,time:dateRSA,today:$filter("date")(dateRSA.getTime(),"yyyy-MM-dd")},ng.fb={nid:ng.nid,msj:"",datePublish:null,timePublish:null,imageAdds:[],imagePost:[],carouselThumbs:[],imageActive:null,accounts:[],preload:!0,postReady:!1,postError:{status:!1,message:""}},$http.get(URL+"redessociales").success(function(data){var data=data;if(data.status){var response=data.response;console.log(response,"response"),ng.fb.accounts=response?response:[],ng.fb.preload=!1}$preload.hide()}).error(function(err){$msj.show("Ocurrio un error. No se obtuvo la configuración guardada.",CMSDATA.POSITIONMSJ),ng.fb.preload=!1});var reviewChooseImg=function(){var arrPortadaThumb=[];arrPortadaThumb.push({url:ng.imgFirst.url,activo:!0});for(var i=0;i<ng.thumbs.length;i++)arrPortadaThumb.push({url:ng.thumbs[i].url,activo:!1});return arrPortadaThumb};$timeout(function(){ng.carouselThumbs=reviewChooseImg()},10),ng.selectCarousel=function($event,$index,thumb){for(var _i=$index,i=0;i<ng.carouselThumbs.length;i++)ng.carouselThumbs[i].activo=!1;ng.carouselThumbs[_i].activo=!0},ng.isCaorusel=!1,ng.chooseImg=function($event,isShow){isShow||(ng.isCaorusel=ng.isCaorusel===!1?!0:!1),ng.carouselThumbs=reviewChooseImg();for(var i=0;i<ng.fb.imageAdds.length;i++)ng.carouselThumbs.push(ng.fb.imageAdds[i])};var elmFileFB=angular.element("#inputFileTriggerFB");elmFileFB.val(""),ng.openLoadImgFB=function($event){var elmFileFB=angular.element("#inputFileTriggerFB");elmFileFB.val(""),elmFileFB.trigger("click"),elmFileFB.unbind("change"),elmFileFB.bind("change",function(){ng.$apply(function(){var files=elmFileFB[0].files;loadPhotoFB(files)})})};var convertFormatFB=function(urlImg){var urlImg=urlImg;return{activo:!1,url:urlImg}},loadPhotoFB=function(files){var files=files,formdata=new FormData;angular.forEach(files,function(v,i){formdata.append("file_"+i,files[i])});var DATA=formdata;$preload.show(),$http.post(URL+URLOADIMGPHOTO,DATA,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data){var data=data;if(data.status){var response=data.response?data.response:[];angular.isArray(response)?angular.forEach(response,function(v,i){response[i]&&(ng.carouselThumbs.push(convertFormatFB(response[i].url)),ng.fb.imageAdds.push(convertFormatFB(response[i].url)))}):(ng.carouselThumbs.push(convertFormatFB(response.url)),ng.fb.imageAdds.push(convertFormatFB(response.url))),$timeout(function(){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ24,positionMSj)},2e3)}else $preload.hide(),$msj.show(CMSDATA.MSJ.MSJ23,positionMSj)}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ23,positionMSj)})};ng.isProgramFB=!1,ng.programPost=function($event){ng.isProgramFB=ng.isProgramFB===!1?!0:!1},ng.insertFBActive=function($event,page,$index,type,parentIndex){var $index=$index,type=type;ng.fb.accounts[type][$index].active=ng.fb.accounts[type][$index].active===!1?!0:!1,ng.fb.postReady=!1},ng.isAccountsFB=!0,ng.sendPostFB=function($event){$preload.show();for(var img1=null,kepp=!0,i=0;i<ng.carouselThumbs.length;i++)kepp===!0&&ng.carouselThumbs[i].activo===!0&&(img1=ng.carouselThumbs[i],kepp=!1);ng.fb.imageActive=ng.isCaorusel?img1:null,ng.fb.carouselThumbs=ng.carouselThumbs;for(var keppPage=!0,i=0;i<ng.fb.accounts.pages.length;i++)keppPage===!0&&ng.fb.accounts.pages[i].active===!0&&(keppPage=!1);for(var keppGroups=!0,i=0;i<ng.fb.accounts.groups.length;i++)keppGroups===!0&&ng.fb.accounts.groups[i].active===!0&&(keppGroups=!1);ng.fb.nid=ng.nid,ng.fb.postReady=!1,ng.fb.postError.status=!1,ng.fb.postError.message="",ng.fb.datePublish=ng.isProgramFB?angular.copy(ng.dateTimeRS.date).getTime():null,ng.fb.timePublish=ng.isProgramFB?angular.copy(ng.dateTimeRS.time).getTime():null;var DATA=angular.copy(ng.fb);console.log(DATA,"DATA FB"),keppPage&&keppGroups?($preload.hide(),ng.fb.postReady=!0):$http.post(URL+"redessociales/facebook_publicar",DATA).success(function(data){var data=data;if(data.status)$preload.hide(),$msj.show("Publicación en Facebook correcta.",positionMSj),ng.fb.msj="",ng.fb.postReady=!1,ng.fb.postError.status=!1,ng.fb.postError.message="",reviewHistory();else{var msjErr=data.error.message?data.error.message:"Ocurrio un error.";ng.fb.postError.message=msjErr,ng.fb.postError.status=!0,$msj.show(msjErr,CMSDATA.POSITIONMSJ)}$preload.hide()}).error(function(err){$preload.hide(),$msj.show("Ocurrio un error.",CMSDATA.POSITIONMSJ)})},ng.historyRS=[];var reviewHistory=function(){var nid=ng.nid;$http.get(URL+"redessociales/facebook_leer_posts/"+nid).success(function(data){var data=data;if(data.status){var response=data.response;ng.historyRS=response?response:[]}$preload.hide()}).error(function(err){})};ng.openRSShare=function($event,post,type){console.log(post,"post");var post=post,type=type,DATA={id:post._id,message:post.message,page_id:post.page_id};switch(console.log(DATA,"DATA 1"),type){case"share":var closeCallback=function(){return!1},permalink=post.permalink,permalink=post.permalink,page_id="rpp"+page_id;$popup.open(permalink,page_id,"1000","500",closeCallback);break;case"edit":$preload.show();var DATA=DATA;$http.post(URL+"redessociales/facebook_actualizar_post",DATA).success(function(data){var data=data;data.status&&(reviewHistory(),$timeout(function(){$preload.hide(),$msj.show("Se actualizo el texto del post correctamente.",positionMSj)},1500)),$preload.hide()}).error(function(err){$preload.hide(),$msj.show("Ocurrio un error al actualizar.",CMSDATA.POSITIONMSJ)});break;case"delete":var DATA=DATA,confirmDeleteRS=$mdDialog.confirm({title:"Confirmación",content:"¿Está seguro que desea eliminar?",ok:"Aceptar",cancel:"Cancelar"});$mdDialog.show(confirmDeleteRS).then(function(){$preload.show(),$http.post(URL+"redessociales/facebook_eliminar_post",DATA).success(function(data){var data=data;data.status&&(reviewHistory(),$timeout(function(){$preload.hide(),$msj.show("Se eliminó correctamente el post.",positionMSj)},1500)),$preload.hide()}).error(function(err){$preload.hide(),$msj.show("Ocurrio un error al eliminar.",CMSDATA.POSITIONMSJ)})})["finally"](function(){confirmDeleteRS=void 0})}},$timeout(function(){reviewHistory()},2e3)},ng.parrafoycita=CMSDATA.GLOBAL.URLVIEW+"parrafoycita.html",ng.agregadorparrafoycita=CMSDATA.GLOBAL.URLVIEW+"agregadorparrafoycita.html",ng.showAddOptions=!1;var scrollToAddBlocks=function(_id){$timeout(function(){$scrollGo.go(_id)},TIMERESULT)};ng.setUrlSection=function(){var section=ng.objCategoryMultiple?ng.objCategoryMultiple.slug:"",tSeo=ng.objTitulo_seo?Slug.slugify(ng.objTitulo_seo):"";if(section){var arrSection=section.split("/");arrSection.splice(0,1),section=arrSection.join("/")}var p=ng.objCategoryMultiple?"/":"";ng.objUrl=section+p+tSeo},ng.blurTitle=function(){void 0===ng.objTitulo_seo?ng.objTitulo_seo=ng.objTitulo:void 0!=ng.objTitulo_seo&&ng.objTitulo_seo.length<=0&&(ng.objTitulo_seo=ng.objTitulo),void 0===ng.objTitulo_corto?ng.objTitulo_corto=ng.objTitulo:void 0!=ng.objTitulo_corto&&ng.objTitulo_corto.length<=0&&(ng.objTitulo_corto=ng.objTitulo),ng.setUrlSection()},ng.changeTitleSeo=function(){ng.setUrlSection()},ng.objCategoryMultiple=void 0,ng.objCategorys=void 0,ng.DATATRANSFERMODAL=void 0,ng.DATARETURNMODAL=void 0,ng.loadCategoryMultiple=function(existCategorys){var _sitio=ng.objSitio;$http.get(URL+URLLISTCATEGORYMULTIPLE+_sitio+"/"+ng.nid).success(function(data){var data=data;if(data.status){if(ng.DATATRANSFERMODAL=data.response,console.log(existCategorys,"existCategorys"),existCategorys){var DATATRANSFER=ng.DATATRANSFERMODAL,mapDataCategory=function(DATATRANSFER){var arrInput=[],arrOutput=[],arrModelSelect=[],DATA=DATATRANSFER;return angular.forEach(DATA,function(v,i){DATA[i].ticked?arrOutput.push(DATA[i]):arrInput.push(DATA[i]),DATA[i].primary&&arrModelSelect.push(DATA[i])}),{input:arrInput,output:arrOutput,modelSelect:arrModelSelect}},RETURNDATATRANSFER=mapDataCategory(DATATRANSFER);console.log(RETURNDATATRANSFER,"RETURNDATATRANSFER"),ng.objCategoryMultiple=RETURNDATATRANSFER.modelSelect[0],ng.objCategorys=angular.copy(RETURNDATATRANSFER.output),ng.setUrlSection()}}else $msj.show(CMSDATA.MSJ.MSJ13,positionMSj)}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ13,positionMSj)})},ng.changeCategorys=function(){var _sitio=ng.objSitio;ng.loadCategoryMultiple(_sitio)},ng.flags.categoryMultiple=!1,ng.clickEditCategoryModal=function($event){ng.flags.categoryMultiple=!0,$mdDialog.show({targetEvent:$event,scope:$scope,preserveScope:!0,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/editcategory.html",controller:modalCategoryAddCtrl}).then(function(){var output=ng.DATARETURNMODAL.output,modelSelect=(ng.DATARETURNMODAL.input,ng.DATARETURNMODAL.modelSelect);modelSelect?(ng.objCategoryMultiple=modelSelect,ng.objCategorys=angular.copy(output)):(ng.objCategoryMultiple=void 0,ng.objCategorys=[]),ng.setUrlSection(),ng.flags.categoryMultiple=!1},function(){$mdDialog.cancel(),ng.flags.categoryMultiple=!1})};var createObjBlocks=function(parrafo1,parrafo2,cita,relacionado,embed,credito,via,tipo,youtube,foto,video,audio,mam,embed_data){var parrafo1=parrafo1,parrafo2=parrafo2,cita=cita,relacionado=relacionado,embed=embed,credito=credito,via=via,tipo=tipo,youtube=youtube,foto=foto,video=video,audio=audio,mam=mam,embed_data=embed_data;return{subtitulo:parrafo1,texto:parrafo2,cita:cita,relacionado:relacionado,embed:embed,credito:credito,via:via,tipo:tipo,youtube:youtube,foto:foto,video:video,audio:audio,mam:mam,embed_data:embed_data}};ng.blockAdd=[],ng.temas=[],ng.tags=[],ng.objCategory=void 0,ng.autorObj=void 0,ng.objSitio=void 0,ng.contenido=createObjBlocks("","",{alineacion:"arriba",titulo:"",desarrollo:""},{alineacion:"arriba",items:[]},"","","","text",{url:"",id:"",autoplay:"",timestamp:"",url_cover:"",descripcion:"",tags:[]},{attr:{align:"center"},id:"",data:"",alt:"",descripcion:"",url:"",tags:[]},{url:"",url_cover:"",duracion:"",hash:"",tags:[]},{url:"",url_cover:"",duracion:"",hash:"",tags:[]},{id:"",datafactory:"",titulo:"",fechaInicio:""},{descripcion:"",tags:[]}),ng.objDate_publish=null,ng.objTime_publish=null,ng.volada="",ng.ticker="",ng.bajada="",ng.entradilla="",ng.titulo="",ng.url="",ng.titulo_seo="",ng.titulo_corto="",ng.fuente="",ng.newsObj={},ng.nid="",ng.objDataFactory="";var refreshObj=function(){var objTemas=[];ng.tagsNames.length>0&&angular.forEach(ng.tagsNames,function(value,key){objTemas.push({slug:ng.tagsNames[key].nombre,nombre:ng.tagsNames[key].nombre})}),ng.temas=angular.copy(objTemas);var objKeywords=[];ng.keywordsNames.length>0&&angular.forEach(ng.keywordsNames,function(value,key){objKeywords.push({slug:ng.keywordsNames[key].nombre,nombre:ng.keywordsNames[key].nombre})}),ng.tags=angular.copy(objKeywords);var selectCategoryPrimary=function(obj){var obj=obj,objNew={nombre:"",slug:""};return obj&&angular.forEach(obj,function(v,i){v.primary&&(objNew.nombre=v.nombre,objNew.slug=v.slug)}),objNew};ng.categoria=selectCategoryPrimary(ng.objCategorys?ng.objCategorys:null),ng.categorias=ng.objCategorys?ng.objCategorys:null,ng.autorA={nombre:ng.objAuthor?ng.objAuthor.nombre:null,slug:ng.objAuthor?ng.objAuthor.slug:null,foto:ng.objAuthor?ng.objAuthor.foto:null},ng.sitio=ng.objSitio?ng.objSitio:null;var objContenido=[];ng.blockAdd.length>0&&(angular.forEach(ng.blockAdd,function(value,key){ng.blockAdd[key].hasOwnProperty("cita")?(null===ng.blockAdd[key].cita.titulo&&(ng.blockAdd[key].cita.titulo=""),null===ng.blockAdd[key].cita.desarrollo&&(ng.blockAdd[key].cita.desarrollo=""),null===ng.blockAdd[key].cita.alineacion&&(ng.blockAdd[key].cita.alineacion=""),null===ng.blockAdd[key].relacionado.alineacion&&(ng.blockAdd[key].relacionado.alineacion="")):ng.blockAdd[key].cita={alineacion:"",titulo:"",desarrollo:""},ng.blockAdd[key].hasOwnProperty("relacionado")?null===ng.blockAdd[key].relacionado.alineacion&&(ng.blockAdd[key].relacionado.alineacion=""):ng.blockAdd[key].relacionado={alineacion:"",items:[]},objContenido.push(createObjBlocks(ng.blockAdd[key].subtitulo,ng.blockAdd[key].texto,{alineacion:ng.blockAdd[key].cita&&(ng.blockAdd[key].cita.titulo.length>0||$filter("htmlToPlaintext")(ng.blockAdd[key].cita.desarrollo).length>0)?ng.blockAdd[key].cita.alineacion:"",titulo:ng.blockAdd[key].cita?ng.blockAdd[key].cita.titulo:"",desarrollo:ng.blockAdd[key].cita?ng.blockAdd[key].cita.desarrollo:""},{alineacion:ng.blockAdd[key].relacionado&&ng.blockAdd[key].relacionado.items.length>0?ng.blockAdd[key].relacionado.alineacion:"",items:ng.blockAdd[key].relacionado?ng.blockAdd[key].relacionado.items:[]},ng.blockAdd[key].embed,ng.blockAdd[key].credito,ng.blockAdd[key].via,ng.blockAdd[key].tipo,ng.blockAdd[key].hasOwnProperty("youtube")?{url:ng.blockAdd[key].youtube.url,id:ng.blockAdd[key].youtube.id,autoplay:ng.blockAdd[key].youtube.autoplay,timestamp:ng.blockAdd[key].youtube.timestamp,url_cover:ng.blockAdd[key].youtube.hasOwnProperty("url_cover")?ng.blockAdd[key].youtube.url_cover:"",descripcion:ng.blockAdd[key].youtube.hasOwnProperty("descripcion")?ng.blockAdd[key].youtube.descripcion:"",tags:ng.blockAdd[key].youtube.hasOwnProperty("tags")?ng.blockAdd[key].youtube.tags:[]}:"",ng.blockAdd[key].hasOwnProperty("foto")?{attr:{align:ng.blockAdd[key].foto.hasOwnProperty("attr")&&ng.blockAdd[key].foto.attr.hasOwnProperty("align")?ng.blockAdd[key].foto.attr.align:""},id:ng.blockAdd[key].foto.id,data:ng.blockAdd[key].foto.data,alt:ng.blockAdd[key].foto.alt,descripcion:ng.blockAdd[key].foto.descripcion,url:ng.blockAdd[key].foto.url,tags:ng.blockAdd[key].foto.tags}:"",{url:ng.blockAdd[key].video?ng.blockAdd[key].video.url:null,url_cover:ng.blockAdd[key].video?ng.blockAdd[key].video.url_cover:null,duracion:ng.blockAdd[key].video?ng.blockAdd[key].video.duracion:null,hash:ng.blockAdd[key].video?ng.blockAdd[key].video.hash:null,descripcion:ng.blockAdd[key].video?ng.blockAdd[key].video.descripcion:null,alt:ng.blockAdd[key].video?ng.blockAdd[key].video.alt:null,tags:ng.blockAdd[key].video?ng.blockAdd[key].video.tags:[]},{url:ng.blockAdd[key].audio?ng.blockAdd[key].audio.url:null,url_cover:ng.blockAdd[key].audio?ng.blockAdd[key].audio.url_cover:null,duracion:ng.blockAdd[key].audio?ng.blockAdd[key].audio.duracion:null,hash:ng.blockAdd[key].audio?ng.blockAdd[key].audio.hash:null,descripcion:ng.blockAdd[key].audio?ng.blockAdd[key].audio.descripcion:null,alt:ng.blockAdd[key].audio?ng.blockAdd[key].audio.alt:null,tags:ng.blockAdd[key].audio?ng.blockAdd[key].audio.tags:[]},{id:ng.blockAdd[key].mam?ng.blockAdd[key].mam.id:null,datafactory:ng.blockAdd[key].mam?ng.blockAdd[key].mam.datafactory:null,titulo:ng.blockAdd[key].mam?ng.blockAdd[key].mam.titulo:null,fechaInicio:ng.blockAdd[key].mam?ng.blockAdd[key].mam.fechaInicio:null},{descripcion:ng.blockAdd[key].embed_data?ng.blockAdd[key].embed_data.descripcion:"",tags:ng.blockAdd[key].embed_data?ng.blockAdd[key].embed_data.tags:[]}))}),ng.contenido=angular.copy(objContenido));var validDateTime=function(date,time){var date=date,time=time,replaceStr=function(str,arrPos,arrValue){for(var arr=str.split(""),i=0;i<arrPos.length;i++)arr[arrPos[i]]=arrValue[i];return arr.join("")};if(null!=date){if(null!=time){var arrTime=time.toString().split(" "),_arrTime=arrTime[4].split(":"),HH=_arrTime[0],MM=_arrTime[1],strDate=date.toString();return date=replaceStr(strDate,[16,17,19,20],(HH+MM).split(""))}return date}return null};ng.date_publish=validDateTime(ng.objDate_publish,ng.objTime_publish),ng.volada=angular.copy(ng.objVolada),ng.ticker=angular.copy(ng.objTicker),ng.bajada=angular.copy(ng.objBajada),ng.entradilla=angular.copy(ng.objEntradilla),ng.titulo=angular.copy(ng.objTitulo),ng.url=angular.copy(ng.objUrl),ng.titulo_seo=angular.copy(ng.objTitulo_seo),ng.titulo_corto=angular.copy(ng.objTitulo_corto),ng.fuente=angular.copy(ng.objFuente),ng.tipo=angular.copy(ng.objTipo),ng.maps=ng.getDataMap(),ng.portada_thumb=function(){var arrPortadaThumb=[];arrPortadaThumb.push({url:ng.imgFirst.url,activo:!0});for(var i=0;i<ng.thumbs.length;i++)arrPortadaThumb.push({url:ng.thumbs[i].url,activo:!1});return arrPortadaThumb},ng.programado=ng.objProgramado,ng.firmarnoticia=ng.objFirmaNoticia,ng.comentariosfb=ng.objComentariosFB,ng.instant_article=ng.objInstantArticle,ng.newsObj={nid:ng.nid,sitio:ng.sitio,tipo:ng.tipo,fecha_publicacion:"",date_publish:ng.date_publish,categoria:ng.categoria,categorias:ng.categorias,volada:ng.volada,ticker:ng.ticker,entradilla:angular.copy(ng.entradilla),bajada:ng.bajada,titulo:ng.titulo,slug:ng.url,titulo_seo:ng.titulo_seo,titulo_corto:ng.titulo_corto,contenido:ng.contenido,permalink:"",autor:ng.autorA,fuente:ng.fuente,stats:"",publicidad:"",config:"",categoria_slug:"",tags:ng.temas,keywords:ng.tags,imagen_portada:{url:ng.imgFirst.url,activo:!0},portada_thumb:ng.portada_thumb(),seo:"",revisions:"",version:"",last_modified:"",created_publish:"",created_time:"",_id:{$id:""},estado:"",mapa:ng.maps,datafactory:ng.objDataFactory,programado:ng.programado,firmarnoticia:ng.firmarnoticia,comentariosfb:ng.comentariosfb,url_externo:ng.objUrlExterno,instant_article:ng.instant_article,imagen_lateral:ng.thumbVertical.imgVertical?ng.thumbVertical.imgVertical:null}};ng.backToList=function(){$location.path("/publicador")},ng.onDropComplete=function(index,obj,evt){var obj=obj,index=index;if(obj&&obj.hasOwnProperty("drag")){if("archive"===obj.drag){delete obj.drag,index=index?index:0;var extension=$isExtension.get(obj.hasOwnProperty("foto")?obj.foto.url:void 0);

"gif"===extension?ng.openAddPhoto(void 0,"edit",index,obj,index):ng.openAddPhoto(void 0,"cropear",index,obj,index)}else delete obj.drag,ng.addMedia(index,obj);reviewAddBlocks()}else{var otherIndex=ng.blockAdd.indexOf(obj);ng.blockAdd.splice(otherIndex,1),ng.blockAdd.splice(index,0,obj),reviewAddBlocks(),loadEventsAjax("drag")}},ng.clickPreview=function($event){refreshObj();var $event=$event,DATA=ng.newsObj;$preload.show(),$http.post(URL+URLPREVIEW,DATA).success(function(data){var data=data;data.status?($mdDialog.show({targetEvent:$event,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/previewnew.html",locals:{response:data.response},controller:addPreviewNews}),$msj.show(CMSDATA.MSJ.MSJ27,"top right")):($preload.hide(),$msj.show(CMSDATA.MSJ.MSJ4,"top right"))}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ4,"top right")})};var toastErrorList=function(errorList,errorMsj){var _err="",errorList=errorList,errorMsj=errorMsj;angular.forEach(errorList,function(v,i){_err+="<li>"+v+"</li>"});var type="toast-error--list";$mdToast.show({template:'<md-toast class="md-toast '+type+'"><p class="p-info">'+errorMsj+":</p><ul>"+_err+"</ul></md-toast>",hideDelay:7e3,position:positionMSj})};ng.clickSave=function($event){refreshObj();var DATA=ng.newsObj;$preload.show(),$http.post(URL+URLSAVE,DATA).success(function(data){var data=data;data.status?(ng.nid=data.response.id,$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ5,positionMSj),getRevisions(ng.nid),clearRevisionErrorFiled("save")):($preload.hide(),toastErrorList(data.error.fields,data.error.message),revisionErrorFiled(data.error.fields))}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ6,positionMSj)})},ng.fields={titulo:"",url:"",titulo_seo:"",titulo_corto:"",categoria:"",contenido:"",tags:"",autor:""};var revisionErrorFiled=function(fields){var fields=fields;fields&&(ng.fields.titulo=fields.hasOwnProperty("titulo")?fields.titulo:"",ng.fields.url=fields.hasOwnProperty("slug")?fields.slug:"",ng.fields.titulo_seo=fields.hasOwnProperty("titulo_seo")?fields.titulo_seo:"",ng.fields.titulo_corto=fields.hasOwnProperty("titulo_corto")?fields.titulo_corto:"",ng.fields.categoria=fields.hasOwnProperty("categoria")?fields.categoria:"",ng.fields.contenido=fields.hasOwnProperty("contenido")?fields.contenido:"",ng.fields.tags=fields.hasOwnProperty("tags")?fields.tags:"",ng.fields.autor=fields.hasOwnProperty("autor")?fields.autor:"")},clearRevisionErrorFiled=function(type){var type=type;(type="publish")?(ng.fields.titulo="",ng.fields.url="",ng.fields.titulo_seo="",ng.fields.titulo_corto="",ng.fields.categoria="",ng.fields.contenido="",ng.fields.tags="",ng.fields.autor=""):(ng.fields.titulo="",ng.fields.url="",ng.fields.categoria="",ng.fields.contenido="",ng.fields.tags="",ng.fields.autor="")};ng.isPublish=!1,ng.getPublish=function(data,type){var data=data,type=type;if("page"===type){var op=data.estado||void 0;ng.isPublish=op&&"publicado"===op||op&&"editado"===op?!0:!1}else{var op=data.op||void 0;ng.isPublish=op&&"PUBLISH"===op||op&&"EDIT"===op?!0:!1}},ng.parentReadyDataByPublish=!1,ng.clickPublish=function($event,type){var $event=$event,type=type;refreshObj();var DATA=ng.newsObj,isPreview=function(){(type="preview")&&$mdDialog.hide()},actionPublish=function(){$http.post(URL+URLPUBLISH,DATA).success(function(data){var data=data;data.status?(ng.nid=data.response.id,$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ9,positionMSj),getRevisions(ng.nid),clearRevisionErrorFiled("publish"),ng.getPublish(data.response,"click"),isPreview()):($preload.hide(),toastErrorList(data.error.fields,data.error.message),revisionErrorFiled(data.error.fields),isPreview())}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ10,positionMSj)})};$preload.show(),"preview"!=type?$http.post(URL+URLVALIDPUBLISH,DATA).success(function(data){var data=data;if(data.status){var response=data.response;response.publicado?(ng.parentReadyDataByPublish=!0,actionPublish()):(ng.parentReadyDataByPublish=!0,clearRevisionErrorFiled("publish"),ng.clickPreview($event,"publish"))}else ng.parentReadyDataByPublish=!1,$preload.hide(),toastErrorList(data.error.fields,data.error.message),revisionErrorFiled(data.error.fields)}).error(function(data){ng.parentReadyDataByPublish=!1,$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ10,positionMSj)}):(ng.parentReadyDataByPublish=!0,actionPublish())};var deleteNewInList=function(nid){var _nid=nid;_nid?$http["delete"](URL+URLDELETE+_nid).success(function(data){var data=data;data.status?(ng.backToList(),$preload.hide()):($preload.hide(),$msj.show(data.message,positionMSj))}).error(function(data){$preload.hide(),ng.isPublish?$msj.show(CMSDATA.MSJ.MSJ38,positionMSj):$msj.show(CMSDATA.MSJ.MSJ8,positionMSj)}):($preload.hide(),$msj.show(CMSDATA.MSJ.MSJ8,positionMSj))};ng.clickDelete=function($event){var confirmDeleteNew=$mdDialog.confirm({title:"Alerta",content:ng.isPublish?"¿Está seguro que desea despublicar?":"¿Está seguro que desea eliminar?",ok:"Aceptar"});$mdDialog.show(confirmDeleteNew).then(function(){$preload.show();var nid=ng.nid;deleteNewInList(nid)})["finally"](function(){confirmDeleteNew=void 0})},ng.clickViewActivity=function(revision){var revision_id=revision.revision_id,nid=revision.nid;$preload.show(),$http.get(URL+URLREVISIONS+nid+"/"+revision_id).success(function(data){var data=data;if(data.status){var objInit=angular.copy(data);init(objInit),$preload.hide(),scrollToAddBlocks("#bodyAddsNews"),$msj.show(CMSDATA.MSJ.MSJ12,positionMSj)}else $preload.hide(),$msj.show(data.error.message,positionMSj)}).error(function(data){$preload.hide(),$msj.show(CMSDATA.MSJ.MSJ11,positionMSj)})},ng.categories=[],ng.loadCategory=function(existCategory){var _sitio=ng.objSitio;$http.get(URL+URLLISTCATEGORY+_sitio).success(function(data){var data=data;data?(ng.categories=data,existCategory&&(ng.objCategory=existCategory)):$msj.show(CMSDATA.MSJ.MSJ32,positionMSj)}).error(function(data){$msj.show(CMSDATA.MSJ.MSJ13,positionMSj)})},ng.fuentes=[],ng.loadFuente=function(existFuente){$cacheService.get(URL+URLFUENTES).then(function(data){var data=data;data.status?(ng.fuentes=data.response,existFuente&&(ng.objFuente=existFuente)):$msj.show(CMSDATA.MSJ.MSJ34,positionMSj)},function(msgError){$msj.show(CMSDATA.MSJ.MSJ34,positionMSj)})};var _lat=-12.046374,_lng=-77.0427934,_lugar="Lima, Perú";ng.showLoadMap=function(_map){var _map=_map;ng.ObjDataMap=_map||{center:{lat:_lat,lng:_lng},lugar:_lugar},ng.objMapZoom=12,ng.objMap=ng.ObjDataMap.lugar?ng.ObjDataMap.lugar:_lugar,ng.objMapLat=ng.ObjDataMap.center?ng.ObjDataMap.center.lat:_lat,ng.objMapLng=ng.ObjDataMap.center?ng.ObjDataMap.center.lng:_lugar,ng.objLatLng=[ng.objMapLat,ng.objMapLng],ng.markerGeo={id:0,name:ng.objMap,lat:ng.objMapLat,lng:ng.objMapLng,position:ng.objLatLng,draggable:!0,animation:google.maps.Animation.BOUNCE,markerClick:function(event){ng.setCenter(event)},onDragEnd:function(event){ng.setCenter(event)}},ng.showMapGoogle=function(_id,_type){var _id=angular.element(_id),_cls="height-none",_type=_type;"open"===_type?_id.removeClass(_cls):_id.hasClass(_cls)?_id.removeClass(_cls):_id.addClass(_cls)};var map,geocoder=new google.maps.Geocoder,noUbication="No se encontro ubicción";ng.$on("mapInitialized",function(evt,evtMap){map=evtMap,ng.updateCenter=function(lat,lng,lugar){var lat=lat,lng=lng,lugar=lugar;ng.objMapLat=lat,ng.objMapLng=lng,ng.objLatLng=[lat,lng],ng.objMap=lugar,angular.extend(ng.markerGeo,{position:[lat,lng]}),ng.objMapZoom=15},ng.codeLatLng=function(lat,lng,type){var lat=lat,lng=lng,latlng=new google.maps.LatLng(lat,lng);geocoder.geocode({latLng:latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){var _result=results[1]||results[0];if(_result){var lugar=_result.formatted_address;if(ng.dataMapInitHTML5.lugar=lugar,type="drag"){var _lugar=lugar.toString();ng.objMapLat=lat,ng.objMapLng=lng,ng.objLatLng=_lugar,ng.objMap=_lugar}return lugar}return noUbication}return noUbication})},ng.dataMapInitHTML5={lat:"",lng:"",lugar:""};var reviewHTML5Geo=function(){var onSuccessGeo=function(position){var lat=position.coords.latitude,lng=position.coords.longitude;ng.dataMapInitHTML5.lat=lat,ng.dataMapInitHTML5.lng=lng,ng.codeLatLng(lat,lng,"review"),ng.$apply()},onErrorGeo=function(error){};navigator.geolocation.getCurrentPosition(onSuccessGeo,onErrorGeo)};reviewHTML5Geo(),ng.reviewDataHTML5=function(){var lat=ng.dataMapInitHTML5.lat,lng=ng.dataMapInitHTML5.lng,lugar=ng.dataMapInitHTML5.lugar;ng.updateCenter(lat,lng,lugar),ng.showMapGoogle("#map-google","open")},ng.methodSearch=function(query,type,latLng){var query=query,type=type,latLng=latLng;if("place"===type&&(latLng.lat||latLng.lng)){var lugar=query,lat=latLng.lat,lng=latLng.lng;ng.updateCenter(lat,lng,lugar),ng.showMapGoogle("#map-google","open"),ng.$apply()}else geocoder.geocode({address:query},function(results,status){if(status==google.maps.GeocoderStatus.OK&&results.length>0){_result=results[1]||results[0];var location=_result.geometry.location,lugar=_result.formatted_address,lat=location.lat(),lng=location.lng();ng.updateCenter(lat,lng,lugar),ng.showMapGoogle("#map-google","open"),ng.$apply()}})};var autocomplete=new google.maps.places.Autocomplete(document.getElementById("inputMapGoogle"));ng.reviewMap=function($event){autocomplete.bindTo("bounds",map)},google.maps.event.addListener(autocomplete,"place_changed",function(){var place=autocomplete.getPlace(),lat=place.geometry?place.geometry.location.A:void 0,lng=place.geometry?place.geometry.location.F:void 0,query=place.formatted_address;ng.methodSearch(query,"place",{lat:lat,lng:lng})}),ng.searchMap=function($event){var query=ng.objMap;ng.methodSearch(query,"click",{lat:void 0,lng:void 0}),ng.objMapZoom=15,$event.preventDefault()},ng.setCenter=function($event){var latLng=$event.latLng,lat=latLng.G,lng=latLng.K,lugar="";ng.updateCenter(lat,lng,lugar),geocoder.geocode({latLng:latLng},function(results,status){var _result=results[1]||results[0],lugar=_result.formatted_address;ng.objMap=lugar,ng.objMapZoom=15,ng.$apply()})}}),ng.getDataMap=function(){return{center:{lat:ng.objMapLat,lng:ng.objMapLng},lugar:ng.objMap}}},ng.imgFirst={url:"",alt:"Imagen de portada"},ng.thumbs=[];var imgDefault=CMSDATA.IMGDEFAULTLA10,imgThumbsLoad=function(nid){var nid=nid,elm=angular.element("#imgFirstThumb");if(nid){var portadaThumb=ng.portadaThumb;if(portadaThumb.length>0)for(var i=0;i<portadaThumb.length;i++)portadaThumb[i].activo?ng.imgFirst.url=portadaThumb[i].url:ng.thumbs.push(portadaThumb[i])}else ng.imgFirst.url=imgDefault;elm.attr("data-thumbs",ng.portadaThumb?ng.portadaThumb.length:"-1")};ng.selectThumb=function($event,thumb,$index){var thumb=thumb,$index=$index;if(thumb){var imgPush=angular.copy(ng.imgFirst);ng.imgFirst={url:thumb.url},ng.thumbs.push(imgPush),ng.thumbs.splice($index,1),ng.chooseImg(void 0,!0)}},ng.addNewPhotoThumb=function(imgData,isBlock){var imgData=imgData,elm=angular.element("#imgFirstThumb");if(isBlock)if(0===ng.thumbs.length)if("-1"===elm.attr("data-thumbs")){var imgPush=angular.copy(ng.imgFirst);ng.thumbs.push(imgPush),ng.imgFirst={url:imgData.url}}else{var imgPush=angular.copy(imgData);ng.thumbs.push(imgPush)}else{var imgPush=angular.copy(imgData);ng.thumbs.push(imgPush)}else{var imgPush=angular.copy(ng.imgFirst);ng.thumbs.push(imgPush),ng.imgFirst={url:imgData.url}}elm.attr("data-thumbs",ng.thumbs.length),ng.chooseImg(void 0,!0)},ng.flags.thumbs=!1,ng.addThumb=function($event){switchFlags(!0),$mdDialog.show({controller:modalThumbAddCtrl,templateUrl:CMSDATA.GLOBAL.URLTEMPLATE+"modal/addthumb.html",targetEvent:$event}).then(function(response){if(response){var imgData=angular.copy(response);imgData&&(ng.addNewPhotoThumb(imgData,!1),$timeout(function(){$preload.hide()},2e3))}switchFlags(!1)},function(){$mdDialog.cancel(),switchFlags(!1)})},ng.thumbVertical={state:!1,imgVertical:{},preload:!1},ng.addThumbVertical=function($event){var evtSuccess=function(data){if(data.status){ng.thumbProgressVertical=!0;var response=data.response;ng.thumbVertical.imgVertical=angular.copy(response[0]),ng.thumbVertical.preload=!0,ng.thumbVertical.state=!1,$timeout(function(){ng.thumbVertical.preload=!1,ng.thumbVertical.state=!0},3e3)}else $msj.show(CMSDATA.MSJ.MSJ23,CMSDATA.POSITIONMSJ)},evtError=function(err){console.log(err,"error")};$loadimg.load(evtSuccess,evtError)};var objInit=nghome.objInitNews,init=function(obj){{var response=obj.response;obj.type}ng.objDate_publish=new Date(response.date_publish),ng.objTime_publish=new Date(response.date_publish),ng.nid=response.nid,ng.objFuente=response.fuente,ng.autorObj=null!=response.autor?response.autor:void 0,ng.objCategory=null!=response.categoria?response.categoria:void 0,ng.objCategorys=null!=response.categorias?response.categorias:void 0,ng.objTitulo=response.titulo,ng.objUrl=null!=response.slug?response.slug:void 0,ng.objTitulo_seo=response.titulo_seo,ng.objTitulo_corto=response.titulo_corto,ng.objBajada=response.bajada,ng.objVolada=response.volada,ng.objTicker=response.ticker,ng.objEntradilla=response.entradilla,ng.tagsNames=response.tags,ng.keywordsNames=response.keywords,ng.blockAdd=response.contenido,ng.objTipo=response.tipo,ng.objSitio=null!=response.sitio?response.sitio:void 0,ng.ObjDataMapEdit=null!=response.mapa?response.mapa:void 0,ng.objDataFactory=null!=response.datafactory?response.datafactory:void 0,ng.portadaThumb=null!=response.portada_thumb?response.portada_thumb:void 0,ng.objProgramado=null!=response.programado?response.programado:!1,ng.objFirmaNoticia=null!=response.firmarnoticia?response.firmarnoticia:!1,ng.objComentariosFB=null!=response.comentariosfb?response.comentariosfb:!0,ng.objUrlExterno=null!=response.url_externo?response.url_externo:void 0,ng.objInstantArticle=null!=response.instant_article?response.instant_article:!1,ng.thumbVertical.imgVertical=null!=response.imagen_lateral?response.imagen_lateral:null,response.imagen_lateral&&(ng.thumbVertical.state=!0),loadEventsAjax("edit")},nidxUrl=$routeParams.nid,noNidLoad=function(){ng.objTipo=objInit?objInit.type:"noticia",ng.loadFuente(void 0),ng.loadAuthorHeader(void 0,"page"),ng.loadSiteHeader(void 0,"page",function(){ng.loadCategory(void 0),ng.loadCategoryMultiple(void 0)}),ng.showLoadMap(void 0),ng.objDate_publish=new Date,ng.objTime_publish=new Date,imgThumbsLoad(void 0)};if(nidxUrl){var _nid=nidxUrl;$preload.show(),$http.get(URL+URLEDITNEWS+_nid).success(function(data){var data=data;if(data.status){var objInit={type:"editar",response:data.response};init(objInit),ng.getPublish(objInit.response,"page"),ng.loadFuente(ng.objFuente),ng.loadAuthorHeader(ng.autorObj,"page"),ng.loadSiteHeader(ng.objSitio,"page",function(){ng.loadCategory(ng.objCategory),ng.loadCategoryMultiple(ng.objCategorys)}),ng.showLoadMap(ng.ObjDataMapEdit),scrollToAddBlocks("#bodyAddsNews"),getRevisions(ng.nid),imgThumbsLoad(ng.nid),ng.isOpenSpeedDial=!1,ng.showOpenText=!1,reviewAddBlocks(),$timeout(function(){$preload.hide()},TIMERESULT)}else noNidLoad(),$timeout(function(){$preload.hide()},TIMERESULT)}).error(function(data){noNidLoad(),$timeout(function(){$preload.hide()},TIMERESULT)})}else objInit&&objInit.response?(init(objInit),ng.getPublish(objInit.response,"page"),ng.loadFuente(ng.objFuente),ng.loadAuthorHeader(ng.autorObj,"page"),ng.loadSiteHeader(ng.objSitio,"page",function(){ng.loadCategory(ng.objCategory),ng.loadCategoryMultiple(ng.objCategorys)}),ng.showLoadMap(ng.ObjDataMapEdit),scrollToAddBlocks("#bodyAddsNews"),imgThumbsLoad(ng.nid),ng.isOpenSpeedDial=!1,ng.showOpenText=!1):(noNidLoad(),ng.isOpenSpeedDial=!0,ng.showOpenText=!0,ng.objComentariosFB=!0);ng.tagsReadonly=!1,ng.tagsNames=[],ng.tagsOnAppend=function(chip){var idemKeywords=!1;return ng.keywordsNames.length>0&&angular.forEach(ng.keywordsNames,function(v,i){chip===v.nombre&&(idemKeywords=!0)}),idemKeywords||ng.keywordsNames.push({nombre:chip,slug:"SLUG"}),{nombre:chip,slug:"SLUG"}},ng.keywordsReadonly=!1,ng.keywordsNames=[],ng.keywordsOnAppend=function(chip){return{nombre:chip,slug:"SLUG"}},ng.revisionProgress=!1,ng.showRevisions=!1,ng.clickShowRevisions=function(ifMoreLess){ng.showRevisions=ifMoreLess?!1:!0};var getRevisions=function(nid){var _nid=nid;nid&&(ng.revisionProgress=!0,$http.get(URL+URLREVISIONS+_nid).success(function(data){var data=data;$timeout(function(){data.status?(ng.revisions=data.response,ng.revisionProgress=!1):ng.revisionProgress=!1},TIMERESULT)}).error(function(data){$timeout(function(){ng.revisionProgress=!1},TIMERESULT)}))};getRevisions(ng.nid),ng.responsiveModal=function(scopeSelect){var $ifrm=angular.element("#ifrm"),scopeSelect=scopeSelect;switch(scopeSelect){case"desktop":$ifrm.width("100%");break;case"tablet":$ifrm.width("767px");break;case"smartphone":$ifrm.width("479px")}}}]);